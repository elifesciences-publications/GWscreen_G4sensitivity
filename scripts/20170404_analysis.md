
This script aims to analyse the data of the mini screen performed by Darcie. It is writen on the basis of:

- [20161011_analysis.md]([20161011_analysis.md])
- [20170105_analysis.md](20170105_analysis.md)
- [20170120_integration_finaldataset.md](20170120_integration_finaldataset.md)
- [20170328_integration_finaldataset_additional_plots.md](20170328_integration_finaldataset_additional_plots.md)
- [20170306_functional_analysis.md](20170306_functional_analysis.md)
- [20170314_cosmic.md](20170314_cosmic.md)



# Analysis of count table (20170407_counts.txt)

```R
library(edgeR)
library(data.table)
library(ggplot2)
library(VennDiagram)
library(reshape)
library(Biostrings)


# Enlarge the view width when printing tables
options(width = 250)


# Load table of counts into edgeR
data <- read.table("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/data/20170404/20170407_counts.txt", header = T)
dim(data) # 7919   31, fine


# Add first column to rownames
rownames(data) <- data[,1]
data <- data[2:31]
dim(data) # 7919   30


# Change to a DGE object
z <- DGEList(counts=data)


# How many counts are on each cell line?
reads_total <- sum(z$counts) # 242251376
reads_total_a375 <- sum(z[,grepl("A375", colnames(z$counts))]$counts) # 116288284
reads_total_ht1080 <- sum(z[,grepl("HT1080", colnames(z$counts))]$counts) # 125963092


# Change column labels z$counts, change row labels z$samples, add group to z$samples, add Replicate to z$samples
treatments <- c(rep("no", 6), rep("DMSO", 3), rep("PDS", 3), rep("PhenDC3", 3), rep("SA100128", 3), rep("DMSO", 3), rep("PhenDC3", 3), rep("PDS", 3), rep("SA100128", 3))
timepoints <- c(rep("t0", 6), rep("t15", 24))
cell_lines <- c(rep("A375", 3), rep("HT1080", 3), rep("A375", 12), rep("HT1080", 12))
replicates <- c(rep(c("1", "2", "3"), 10))

colnames(z$counts) <- paste(timepoints, treatments, cell_lines, replicates, sep="_")
rownames(z$samples) <- paste(timepoints, treatments, cell_lines, replicates, sep="_")
z$samples$group <- paste(timepoints, treatments, cell_lines, sep="_")
z$samples$Replicate <- replicates


# Select cell lines A375 and HT1080 as z_a375 and z_ht1080, and redefine the corresponding $samples$lib.size
# A375
z_a375 <- z[, grepl("A375", colnames(z$counts))]
keep_a375 <- rowSums(z_a375$counts) > 0
z_a375 <- z_a375[keep_a375, , keep.lib.sizes=FALSE]
z_a375$samples$lib.size <- as.vector(colSums(z_a375$counts))

# HT1080
z_ht1080 <- z[, grepl("HT1080", colnames(z$counts))]
keep_ht1080 <- rowSums(z_ht1080$counts) > 0
z_ht1080 <- z_ht1080[keep_ht1080, , keep.lib.sizes=FALSE]
z_ht1080$samples$lib.size <- as.vector(colSums(z_ht1080$counts))


# Write raw counts to tables (A375 and HT1080)
write.table(z_a375$counts, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/data/20170404/20170410_counts_A375.txt", quote = FALSE, sep = "\t")
write.table(z_ht1080$counts, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/data/20170404/20170410_counts_HT1080.txt", quote = FALSE, sep = "\t")

system("rsync -arvuP /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/data/20170404/20170410_counts_A375.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/")
system("rsync -arvuP /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/data/20170404/20170410_counts_HT1080.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/")


# Plot number of hairpins that could be matched per cell line
# and total for each hairpin across all samples
# A375
par(mfrow=c(2,1))
barplot(colSums(z_a375$counts), las=2, main="Counts per index", cex.names=0.5, cex.axis=0.8)
barplot(rowSums(z_a375$counts), las=2, main="Counts per hairpin", cex.names=0.5, cex.axis=0.8, axisnames = FALSE)

sort(rowSums(z_a375$counts)[rowSums(z_a375$counts) > 300000], decreasing=T)
#MTPAP__2__2__ULTRA-3345059   LATS2__sherwood_1u__3__ULTRA-3427722 TP53__sherwood_1u__1__1__ULTRA-3382846
#                    417913                                 340815                                 302467

# A375 t0
par(mfrow=c(2,1))
barplot(colSums(z_a375[, grepl("t0", colnames(z_a375$counts))]$counts), las=2, main="Counts per index", cex.names=0.5, cex.axis=0.8)
barplot(rowSums(z_a375[, grepl("t0", colnames(z_a375$counts))]$counts), las=2, main="Counts per hairpin", cex.names=0.5, cex.axis=0.8, axisnames = FALSE)

sort(rowSums(z_a375[, grepl("t0", colnames(z_a375$counts))]$counts)[rowSums(z_a375[, grepl("t0", colnames(z_a375$counts))]$counts) > 100000], decreasing=T)
#MTPAP__2__2__ULTRA-3345059
#                    134744

# HT1080
par(mfrow=c(2,1))
barplot(colSums(z_ht1080$counts), las=2, main="Counts per index", cex.names=0.5, cex.axis=0.8)
barplot(rowSums(z_ht1080$counts), las=2, main="Counts per hairpin", cex.names=0.5, cex.axis=0.8, axisnames = FALSE)

sort(rowSums(z_ht1080$counts)[rowSums(z_ht1080$counts) > 1000000], decreasing=T)
#TP53__sherwood_1u__1__1__ULTRA-3382846   TP53__sherwood_1u__3__3__RRUH-139269             TAF12__3__3__ULTRA-3377188             TAF12__1__1__ULTRA-3377186
#                               8678950                                2518605                                1444257                                1031348

# HT1080 t0
par(mfrow=c(2,1))
barplot(colSums(z_ht1080[, grepl("t0", colnames(z_ht1080$counts))]$counts), las=2, main="Counts per index", cex.names=0.5, cex.axis=0.8)
barplot(rowSums(z_ht1080[, grepl("t0", colnames(z_ht1080$counts))]$counts), las=2, main="Counts per hairpin", cex.names=0.5, cex.axis=0.8, axisnames = FALSE)

sort(rowSums(z_ht1080[, grepl("t0", colnames(z_ht1080$counts))]$counts)[rowSums(z_ht1080[, grepl("t0", colnames(z_ht1080$counts))]$counts) > 100000], decreasing=T)
#TP53__sherwood_1u__1__1__ULTRA-3382846
#                                116190

# There seems to be a lot of TP53 effect upon drug treatment



# Make MDS plots to visualise relationships between replicate samples
pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170410_A375_mds.pdf", width = 16/2.54, height = 16/2.54)
g <- plotMDS(z_a375, labels = c(rep("t0", 3), rep("DMSO", 3), rep("PDS", 3), rep("PhenDC3", 3), rep("SA100128", 3)), col = c(rep("black", 3), rep("deepskyblue3", 3), rep("red3", 3), rep("forestgreen", 3), rep("goldenrod3", 3)), xlab = "Dimension 1", ylab = "Dimension 2",  gene.selection = "common")
legend("top", legend=c("t0", "DMSO", "PDS", "PhenDC3", "SA100128"), col=c("black", "deepskyblue3", "red3", "forestgreen", "goldenrod3"), pch=15)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170410_A375_mds.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/mds")

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170410_HT1080_mds.pdf", width = 16/2.54, height = 16/2.54)
g <- plotMDS(z_ht1080, labels = c(rep("t0", 3), rep("DMSO", 3), rep("PhenDC3", 3), rep("PDS", 3), rep("SA100128", 3)), col = c(rep("black", 3), rep("deepskyblue3", 3), rep("forestgreen", 3), rep("red3", 3), rep("goldenrod3", 3)), xlab = "Dimension 1", ylab = "Dimension 2",  gene.selection = "common")
legend("bottomleft", legend=c("t0", "DMSO", "PDS", "PhenDC3", "SA100128"), col=c("black", "deepskyblue3", "red3", "forestgreen", "goldenrod3"), pch=15)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170410_HT1080_mds.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/mds")


##########
##########
## A375 ##
##########
##########


# Distribution of the number of genes by the number of shRNAs
genes_dataframe <- data.frame(shRNA = rownames(z_a375), gene = as.character(sapply(rownames(z_a375), function(x) unlist(strsplit(x, "__"))[1])))
z_a375$genes <- genes_dataframe
z_a375["DHX36__sensor__1__ULTRA-3226137",]

gg <- ggplot(data.table(table(sort(table(z_a375$genes$gene)))), aes(x = as.numeric(V1), y = N)) +
geom_bar(stat="identity") +
xlab("Number of shRNAs") +
ylab("Number of genes") +
theme_classic()

ggsave("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170410_A375_numbershRNAs_numbergenes.pdf", width = 10/2.54, height = 10/2.54)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170410_A375_numbershRNAs_numbergenes.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/distribution")


# What are the genes with more different shRNAs detected?
head(sort(table(z_a375$genes$gene), decreasing = TRUE), n = 20)
#ERCC6   EIF4A2   RECQL5     AATK    ABCB1    ABCB7    ABCG8     ACO2    ACOXL    ACSL6    ACSS3    ACVR1   ACVR2B   ADAM17 ADAMTS15     ADAR    ADCK5    ADH1A    ADH1C     ADH4
#    9        8        8        7        7        7        7        7        7        7        7        7        7        7        7        7        7        7        7        7


# Filtering
print(sprintf("shRNAs: %s", nrow(z_a375$counts))) # 7910
keep <- rowSums(cpm(z_a375[,1:3])>0.5) >= 3 # A library of 10M will need to have at least 5 counts in each of three t0 replicates individually in order to pass this filter
z_a375 <- z_a375[keep, , keep.lib.sizes=FALSE]
print(sprintf("shRNAs (after filtering): %s", nrow(z_a375$counts))) # 7498


# Normalisation
z_a375 <- calcNormFactors(z_a375)


# Differential representation analysis.
# Set up design matrix for GLM.
des <- model.matrix(~ 0 + group, data = z_a375$samples)
colnames(des) <- levels(factor(z_a375$samples$group))


# Estimate common dispersion
z_a375_glm <- estimateDisp(z_a375, des)
print(sprintf("Common dispersion: %s", sqrt(z_a375_glm$common.disp))) # 0.387278901640172


# Fit negative binomial GLM
z_a375_fit <- glmFit(z_a375_glm, des)


# Define matrix of contrasts
my.contrasts <- makeContrasts(
DMSOvst0 = t15_DMSO_A375 - t0_no_A375,
PDSvst0 = t15_PDS_A375 - t0_no_A375,
PhenDC3vst0 = t15_PhenDC3_A375 - t0_no_A375,
SA100128vst0 = t15_SA100128_A375 - t0_no_A375,
levels=des)


# Comparisons t15 vs t0
# Carry out Likelihood ratio tests
lrt_a375_DMSOvst0 <- glmLRT(z_a375_fit, contrast=my.contrasts[,"DMSOvst0"])
lrt_a375_PDSvst0 <- glmLRT(z_a375_fit, contrast=my.contrasts[,"PDSvst0"])
lrt_a375_PhenDC3vst0 <- glmLRT(z_a375_fit, contrast=my.contrasts[,"PhenDC3vst0"])
lrt_a375_SA100128vst0 <- glmLRT(z_a375_fit, contrast=my.contrasts[,"SA100128vst0"])


# Get ranked shRNAS and combine shRNAs into a table
## DMSOvst0
top_a375_DMSOvst0 <- data.table(topTags(lrt_a375_DMSOvst0, n=Inf)$table)[order(FDR),.(gene, shRNA, logFC, FDR)]
## PDSvst0
top_a375_PDSvst0 <- data.table(topTags(lrt_a375_PDSvst0, n=Inf)$table)[order(FDR),.(gene, shRNA, logFC, FDR)]
## PhenDC3vst0
top_a375_PhenDC3vst0 <- data.table(topTags(lrt_a375_PhenDC3vst0, n=Inf)$table)[order(FDR),.(gene, shRNA, logFC, FDR)]
## SA100128vst0
top_a375_SA100128vst0 <- data.table(topTags(lrt_a375_SA100128vst0, n=Inf)$table)[order(FDR),.(gene, shRNA, logFC, FDR)]



# Create directory structure for figures and tables below
system("ssh martin03@nm149s012925 mkdir -p /media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_all")
system("ssh martin03@nm149s012925 mkdir -p /media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/shRNAs_all")
system("ssh martin03@nm149s012925 mkdir -p /media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_lost")
system("ssh martin03@nm149s012925 mkdir -p /media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")
system("ssh martin03@nm149s012925 mkdir -p /media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")



# Tables of genes by DMSOvst0, PDSvst0 and PhenDC3vst0 and for resistant (logFC>0) or sensitiser (logFC<0)

## All genes
f <- readDNAStringSet("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/data/20170404/reference/20170120_Miniscreen_directory.fa")
all_shRNAs <- names(f)
all_genes <- data.table(table(as.character(sapply(all_shRNAs, function(x) unlist(strsplit(x, "__"))[1])))) # all genes, 1358

## DMSOvst0
detected_genes_a375_DMSOvst0 <- top_a375_DMSOvst0[,.(n_detected_shRNA = uniqueN(shRNA)), by = gene] # detected genes DMSOvst0, 1352, 6 genes with no shRNAs detected, shRNAs filtered are not included in this table either

all_detected_genes_a375_DMSOvst0 <- merge(all_genes, detected_genes_a375_DMSOvst0, by.x="V1", by.y="gene", all=T)
setnames(all_detected_genes_a375_DMSOvst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs"))

significant_resistant_genes_a375_DMSOvst0 <- top_a375_DMSOvst0[FDR <= 0.05 & logFC > 0,.(n_significant_resistant_shRNAs = uniqueN(shRNA), logFC_significant_resistant_shRNAs_average = mean(logFC), FC_significant_resistant_shRNAs_average = 2^(mean(logFC)), logFC_significant_resistant_shRNAs_median = median(logFC), FC_significant_resistant_shRNAs_median = 2^(median(logFC))), by = gene] # significant and resistant genes DMSOvst0, 241
significant_sensitiser_genes_a375_DMSOvst0 <- top_a375_DMSOvst0[FDR <= 0.05 & logFC < 0,.(n_significant_sensitiser_shRNAs = uniqueN(shRNA), logFC_significant_sensitiser_shRNAs_average = mean(logFC), FC_significant_sensitiser_shRNAs_average = 2^(mean(logFC)), logFC_significant_sensitiser_shRNAs_median = median(logFC), FC_significant_sensitiser_shRNAs_median = 2^(median(logFC))), by = gene] # significant and sensitiser genes DMSOvst0, 188
length(intersect(significant_resistant_genes_a375_DMSOvst0$gene, significant_sensitiser_genes_a375_DMSOvst0$gene)) # 22

all_detected_significant_resistant_genes_a375_DMSOvst0 <- merge(all_detected_genes_a375_DMSOvst0, significant_resistant_genes_a375_DMSOvst0, by.x="gene", by.y="gene", all=T)
all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0 <- merge(all_detected_significant_resistant_genes_a375_DMSOvst0, significant_sensitiser_genes_a375_DMSOvst0, by.x="gene", by.y="gene", all=T)

for (j in c("n_detected_shRNAs", "n_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs")){
  set(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0, which(is.na(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[[j]])),j,0)
}

all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[, pct_significant_resistant_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_resistant_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[, pass_50_threshold_significant_resistant_shRNAs := ifelse(pct_significant_resistant_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[, pass_3_significant_resistant_shRNAs := ifelse(n_significant_resistant_shRNAs >= 3, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[, pct_significant_sensitiser_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_sensitiser_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[, pass_50_threshold_significant_sensitiser_shRNAs := ifelse(pct_significant_sensitiser_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[, pass_3_significant_sensitiser_shRNAs := ifelse(n_significant_sensitiser_shRNAs >= 3, "yes", "no")]

setcolorder(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs", "n_significant_resistant_shRNAs", "logFC_significant_resistant_shRNAs_average", "FC_significant_resistant_shRNAs_average", "logFC_significant_resistant_shRNAs_median", "FC_significant_resistant_shRNAs_median", "pct_significant_resistant_shRNAs", "pass_50_threshold_significant_resistant_shRNAs", "pass_3_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs", "logFC_significant_sensitiser_shRNAs_average", "FC_significant_sensitiser_shRNAs_average", "logFC_significant_sensitiser_shRNAs_median", "FC_significant_sensitiser_shRNAs_median", "pct_significant_sensitiser_shRNAs", "pass_50_threshold_significant_sensitiser_shRNAs", "pass_3_significant_sensitiser_shRNAs"))

all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0["DHX36"]
#gene n_total_shRNAs n_detected_shRNAs n_significant_resistant_shRNAs logFC_significant_resistant_shRNAs_average FC_significant_resistant_shRNAs_average logFC_significant_resistant_shRNAs_median FC_significant_resistant_shRNAs_median
#1: DHX36              7                 7                              0                                         NA                                      NA                                        NA                                     NA
#pct_significant_resistant_shRNAs pass_50_threshold_significant_resistant_shRNAs pass_3_significant_resistant_shRNAs n_significant_sensitiser_shRNAs logFC_significant_sensitiser_shRNAs_average FC_significant_sensitiser_shRNAs_average
#1:                                0                                             no                                  no                               0                                          NA                                       NA
#logFC_significant_sensitiser_shRNAs_median FC_significant_sensitiser_shRNAs_median pct_significant_sensitiser_shRNAs pass_50_threshold_significant_sensitiser_shRNAs pass_3_significant_sensitiser_shRNAs
#1:                                         NA                                      NA                                 0                                              no                                   no

nrow(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]) # 23 genes are resistant in DMSOvst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC > 0
nrow(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]) # 10 genes are sensitiser in DMSOvst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC < 0
nrow(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[(pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes") & (pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes")]) # 0 genes are both resistant and sensitiser in DMSOvst0

write.table(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_DMSOvst0_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_DMSOvst0_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_all")

## PDSvst0
detected_genes_a375_PDSvst0 <- top_a375_PDSvst0[,.(n_detected_shRNA = uniqueN(shRNA)), by = gene] # detected genes PDSvst0, 1352, 6 genes with no shRNAs detected, shRNAs filtered are not included in this table either

all_detected_genes_a375_PDSvst0 <- merge(all_genes, detected_genes_a375_PDSvst0, by.x="V1", by.y="gene", all=T)
setnames(all_detected_genes_a375_PDSvst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs"))

significant_resistant_genes_a375_PDSvst0 <- top_a375_PDSvst0[FDR <= 0.05 & logFC > 0,.(n_significant_resistant_shRNAs = uniqueN(shRNA), logFC_significant_resistant_shRNAs_average = mean(logFC), FC_significant_resistant_shRNAs_average = 2^(mean(logFC)), logFC_significant_resistant_shRNAs_median = median(logFC), FC_significant_resistant_shRNAs_median = 2^(median(logFC))), by = gene] # significant and resistant genes PDSvst0, 744
significant_sensitiser_genes_a375_PDSvst0 <- top_a375_PDSvst0[FDR <= 0.05 & logFC < 0,.(n_significant_sensitiser_shRNAs = uniqueN(shRNA), logFC_significant_sensitiser_shRNAs_average = mean(logFC), FC_significant_sensitiser_shRNAs_average = 2^(mean(logFC)), logFC_significant_sensitiser_shRNAs_median = median(logFC), FC_significant_sensitiser_shRNAs_median = 2^(median(logFC))), by = gene] # significant and sensitiser genes PDSvst0, 728
length(intersect(significant_resistant_genes_a375_PDSvst0$gene, significant_sensitiser_genes_a375_PDSvst0$gene)) # 304

all_detected_significant_resistant_genes_a375_PDSvst0 <- merge(all_detected_genes_a375_PDSvst0, significant_resistant_genes_a375_PDSvst0, by.x="gene", by.y="gene", all=T)
all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0 <- merge(all_detected_significant_resistant_genes_a375_PDSvst0, significant_sensitiser_genes_a375_PDSvst0, by.x="gene", by.y="gene", all=T)

for (j in c("n_detected_shRNAs", "n_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs")){
  set(all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0, which(is.na(all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[[j]])),j,0)
}

all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[, pct_significant_resistant_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_resistant_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[, pass_50_threshold_significant_resistant_shRNAs := ifelse(pct_significant_resistant_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[, pass_3_significant_resistant_shRNAs := ifelse(n_significant_resistant_shRNAs >= 3, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[, pct_significant_sensitiser_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_sensitiser_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[, pass_50_threshold_significant_sensitiser_shRNAs := ifelse(pct_significant_sensitiser_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[, pass_3_significant_sensitiser_shRNAs := ifelse(n_significant_sensitiser_shRNAs >= 3, "yes", "no")]

setcolorder(all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs", "n_significant_resistant_shRNAs", "logFC_significant_resistant_shRNAs_average", "FC_significant_resistant_shRNAs_average", "logFC_significant_resistant_shRNAs_median", "FC_significant_resistant_shRNAs_median", "pct_significant_resistant_shRNAs", "pass_50_threshold_significant_resistant_shRNAs", "pass_3_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs", "logFC_significant_sensitiser_shRNAs_average", "FC_significant_sensitiser_shRNAs_average", "logFC_significant_sensitiser_shRNAs_median", "FC_significant_sensitiser_shRNAs_median", "pct_significant_sensitiser_shRNAs", "pass_50_threshold_significant_sensitiser_shRNAs", "pass_3_significant_sensitiser_shRNAs"))

all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0["DHX36"]
#gene n_total_shRNAs n_detected_shRNAs n_significant_resistant_shRNAs logFC_significant_resistant_shRNAs_average FC_significant_resistant_shRNAs_average logFC_significant_resistant_shRNAs_median FC_significant_resistant_shRNAs_median
#1: DHX36              7                 7                              0                                         NA                                      NA                                        NA                                     NA
#pct_significant_resistant_shRNAs pass_50_threshold_significant_resistant_shRNAs pass_3_significant_resistant_shRNAs n_significant_sensitiser_shRNAs logFC_significant_sensitiser_shRNAs_average FC_significant_sensitiser_shRNAs_average
#1:                                0                                             no                                  no                               0                                          NA                                       NA
#logFC_significant_sensitiser_shRNAs_median FC_significant_sensitiser_shRNAs_median pct_significant_sensitiser_shRNAs pass_50_threshold_significant_sensitiser_shRNAs pass_3_significant_sensitiser_shRNAs
#1:                                         NA                                      NA                                 0                                              no                                   no

nrow(all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]) # 225 genes are resistant in PDSvst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC > 0
nrow(all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]) # 257 genes are sensitiser in PDSvst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC < 0
nrow(all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[(pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes") & (pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes")]) # 3 genes are both resistant and sensitiser in PDSvst0, SLC24A6, SPACA7 and UTS2D

write.table(all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PDSvst0_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PDSvst0_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_all")

## PhenDC3vst0
detected_genes_a375_PhenDC3vst0 <- top_a375_PhenDC3vst0[,.(n_detected_shRNA = uniqueN(shRNA)), by = gene] # detected genes PhenDC3vst0, 1352, 6 genes with no shRNAs detected, shRNAs filtered are not included in this table either

all_detected_genes_a375_PhenDC3vst0 <- merge(all_genes, detected_genes_a375_PhenDC3vst0, by.x="V1", by.y="gene", all=T)
setnames(all_detected_genes_a375_PhenDC3vst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs"))

significant_resistant_genes_a375_PhenDC3vst0 <- top_a375_PhenDC3vst0[FDR <= 0.05 & logFC > 0,.(n_significant_resistant_shRNAs = uniqueN(shRNA), logFC_significant_resistant_shRNAs_average = mean(logFC), FC_significant_resistant_shRNAs_average = 2^(mean(logFC)), logFC_significant_resistant_shRNAs_median = median(logFC), FC_significant_resistant_shRNAs_median = 2^(median(logFC))), by = gene] # significant and resistant genes PhenDC3vst0, 786
significant_sensitiser_genes_a375_PhenDC3vst0 <- top_a375_PhenDC3vst0[FDR <= 0.05 & logFC < 0,.(n_significant_sensitiser_shRNAs = uniqueN(shRNA), logFC_significant_sensitiser_shRNAs_average = mean(logFC), FC_significant_sensitiser_shRNAs_average = 2^(mean(logFC)), logFC_significant_sensitiser_shRNAs_median = median(logFC), FC_significant_sensitiser_shRNAs_median = 2^(median(logFC))), by = gene] # significant and sensitiser genes PhenDC3vst0, 762
length(intersect(significant_resistant_genes_a375_PhenDC3vst0$gene, significant_sensitiser_genes_a375_PhenDC3vst0$gene)) # 338

all_detected_significant_resistant_genes_a375_PhenDC3vst0 <- merge(all_detected_genes_a375_PhenDC3vst0, significant_resistant_genes_a375_PhenDC3vst0, by.x="gene", by.y="gene", all=T)
all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0 <- merge(all_detected_significant_resistant_genes_a375_PhenDC3vst0, significant_sensitiser_genes_a375_PhenDC3vst0, by.x="gene", by.y="gene", all=T)

for (j in c("n_detected_shRNAs", "n_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs")){
  set(all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0, which(is.na(all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[[j]])),j,0)
}

all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[, pct_significant_resistant_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_resistant_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[, pass_50_threshold_significant_resistant_shRNAs := ifelse(pct_significant_resistant_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[, pass_3_significant_resistant_shRNAs := ifelse(n_significant_resistant_shRNAs >= 3, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[, pct_significant_sensitiser_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_sensitiser_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[, pass_50_threshold_significant_sensitiser_shRNAs := ifelse(pct_significant_sensitiser_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[, pass_3_significant_sensitiser_shRNAs := ifelse(n_significant_sensitiser_shRNAs >= 3, "yes", "no")]

setcolorder(all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs", "n_significant_resistant_shRNAs", "logFC_significant_resistant_shRNAs_average", "FC_significant_resistant_shRNAs_average",  "logFC_significant_resistant_shRNAs_median", "FC_significant_resistant_shRNAs_median", "pct_significant_resistant_shRNAs", "pass_50_threshold_significant_resistant_shRNAs", "pass_3_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs", "logFC_significant_sensitiser_shRNAs_average", "FC_significant_sensitiser_shRNAs_average", "logFC_significant_sensitiser_shRNAs_median", "FC_significant_sensitiser_shRNAs_median", "pct_significant_sensitiser_shRNAs", "pass_50_threshold_significant_sensitiser_shRNAs", "pass_3_significant_sensitiser_shRNAs"))

all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0["DHX36"]
#gene n_total_shRNAs n_detected_shRNAs n_significant_resistant_shRNAs logFC_significant_resistant_shRNAs_average FC_significant_resistant_shRNAs_average logFC_significant_resistant_shRNAs_median FC_significant_resistant_shRNAs_median
#1: DHX36              7                 7                              0                                         NA                                      NA                                        NA                                     NA
#pct_significant_resistant_shRNAs pass_50_threshold_significant_resistant_shRNAs pass_3_significant_resistant_shRNAs n_significant_sensitiser_shRNAs logFC_significant_sensitiser_shRNAs_average FC_significant_sensitiser_shRNAs_average
#1:                                0                                             no                                  no                               7                                   -4.636491                               0.04020472
#logFC_significant_sensitiser_shRNAs_median FC_significant_sensitiser_shRNAs_median pct_significant_sensitiser_shRNAs pass_50_threshold_significant_sensitiser_shRNAs pass_3_significant_sensitiser_shRNAs
#1:                                  -4.520558                              0.04356887                               100                                             yes                                  yes

nrow(all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]) # 253 genes are resistant in PhenDC3vst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC > 0
nrow(all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]) # 281 genes are sensitiser in PhenDC3vst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC < 0
nrow(all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[(pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes") & (pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes")]) # 3 genes are both resistant and sensitiser in PhenDC3vst0 at the same time, SNRPD2, TMOD4 and UTS2D

write.table(all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PhenDC3vst0_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PhenDC3vst0_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_all")

## SA100128vst0
detected_genes_a375_SA100128vst0 <- top_a375_SA100128vst0[,.(n_detected_shRNA = uniqueN(shRNA)), by = gene] # detected genes SA100128vst0, 1352, 6 genes with no shRNAs detected, shRNAs filtered are not included in this table either

all_detected_genes_a375_SA100128vst0 <- merge(all_genes, detected_genes_a375_SA100128vst0, by.x="V1", by.y="gene", all=T)
setnames(all_detected_genes_a375_SA100128vst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs"))

significant_resistant_genes_a375_SA100128vst0 <- top_a375_SA100128vst0[FDR <= 0.05 & logFC > 0,.(n_significant_resistant_shRNAs = uniqueN(shRNA), logFC_significant_resistant_shRNAs_average = mean(logFC), FC_significant_resistant_shRNAs_average = 2^(mean(logFC)), logFC_significant_resistant_shRNAs_median = median(logFC), FC_significant_resistant_shRNAs_median = 2^(median(logFC))), by = gene] # significant and resistant genes SA100128vst0, 389
significant_sensitiser_genes_a375_SA100128vst0 <- top_a375_SA100128vst0[FDR <= 0.05 & logFC < 0,.(n_significant_sensitiser_shRNAs = uniqueN(shRNA), logFC_significant_sensitiser_shRNAs_average = mean(logFC), FC_significant_sensitiser_shRNAs_average = 2^(mean(logFC)), logFC_significant_sensitiser_shRNAs_median = median(logFC), FC_significant_sensitiser_shRNAs_median = 2^(median(logFC))), by = gene] # significant and sensitiser genes SA100128vst0, 392
length(intersect(significant_resistant_genes_a375_SA100128vst0$gene, significant_sensitiser_genes_a375_SA100128vst0$gene)) # 80

all_detected_significant_resistant_genes_a375_SA100128vst0 <- merge(all_detected_genes_a375_SA100128vst0, significant_resistant_genes_a375_SA100128vst0, by.x="gene", by.y="gene", all=T)
all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0 <- merge(all_detected_significant_resistant_genes_a375_SA100128vst0, significant_sensitiser_genes_a375_SA100128vst0, by.x="gene", by.y="gene", all=T)

for (j in c("n_detected_shRNAs", "n_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs")){
  set(all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0, which(is.na(all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[[j]])),j,0)
}

all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[, pct_significant_resistant_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_resistant_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[, pass_50_threshold_significant_resistant_shRNAs := ifelse(pct_significant_resistant_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[, pass_3_significant_resistant_shRNAs := ifelse(n_significant_resistant_shRNAs >= 3, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[, pct_significant_sensitiser_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_sensitiser_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[, pass_50_threshold_significant_sensitiser_shRNAs := ifelse(pct_significant_sensitiser_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[, pass_3_significant_sensitiser_shRNAs := ifelse(n_significant_sensitiser_shRNAs >= 3, "yes", "no")]

setcolorder(all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs", "n_significant_resistant_shRNAs", "logFC_significant_resistant_shRNAs_average", "FC_significant_resistant_shRNAs_average",  "logFC_significant_resistant_shRNAs_median", "FC_significant_resistant_shRNAs_median", "pct_significant_resistant_shRNAs", "pass_50_threshold_significant_resistant_shRNAs", "pass_3_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs", "logFC_significant_sensitiser_shRNAs_average", "FC_significant_sensitiser_shRNAs_average", "logFC_significant_sensitiser_shRNAs_median", "FC_significant_sensitiser_shRNAs_median", "pct_significant_sensitiser_shRNAs", "pass_50_threshold_significant_sensitiser_shRNAs", "pass_3_significant_sensitiser_shRNAs"))

all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0["DHX36"]
#gene n_total_shRNAs n_detected_shRNAs n_significant_resistant_shRNAs logFC_significant_resistant_shRNAs_average FC_significant_resistant_shRNAs_average logFC_significant_resistant_shRNAs_median FC_significant_resistant_shRNAs_median
#1: DHX36              7                 7                              0                                         NA                                      NA                                        NA                                     NA
#pct_significant_resistant_shRNAs pass_50_threshold_significant_resistant_shRNAs pass_3_significant_resistant_shRNAs n_significant_sensitiser_shRNAs logFC_significant_sensitiser_shRNAs_average FC_significant_sensitiser_shRNAs_average
#1:                                0                                             no                                  no                               2                                   -1.382376                                0.3835866
#logFC_significant_sensitiser_shRNAs_median FC_significant_sensitiser_shRNAs_median pct_significant_sensitiser_shRNAs pass_50_threshold_significant_sensitiser_shRNAs pass_3_significant_sensitiser_shRNAs
#1:                                  -1.382376                               0.3835866                          28.57143                                              no                                   no

nrow(all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]) # 33 genes are resistant in SA100128vst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC > 0
nrow(all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]) # 45 genes are sensitiser in SA100128vst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC < 0
nrow(all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[(pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes") & (pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes")]) # 0 genes are both resistant and sensitiser in SA100128vst0 at the same time

write.table(all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_SA100128vst0_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_SA100128vst0_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_all")



# Tables of shRNAs by DMSOvst0, PDSvst0, PhenDC3vst0 and SA100128vst0 including transomic scores

scores <- data.table(read.table("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/data/20170404/reference/20170120_Miniscreen_directory_scores.txt")) # I manually deleted additional "__" from "EGFP__881 __"
setnames(scores, c("cshlid_ultra_id","score") )

# DMSOvst0
top_a375_DMSOvst0_scores <- merge(top_a375_DMSOvst0, scores, by.x="shRNA", by.y="cshlid_ultra_id", all.x=T)[order(gene, FDR), .(gene, shRNA, score, logFC, FDR)]
write.table(top_a375_DMSOvst0_scores, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_DMSOvst0_shRNAs.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_DMSOvst0_shRNAs.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/shRNAs_all")

# PDSvst0
top_a375_PDSvst0_scores <- merge(top_a375_PDSvst0, scores, by.x="shRNA", by.y="cshlid_ultra_id", all.x=T)[order(gene, FDR), .(gene, shRNA, score, logFC, FDR)]
write.table(top_a375_PDSvst0_scores, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PDSvst0_shRNAs.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PDSvst0_shRNAs.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/shRNAs_all")

# PhenDC3vst0
top_a375_PhenDC3vst0_scores <- merge(top_a375_PhenDC3vst0, scores, by.x="shRNA", by.y="cshlid_ultra_id", all.x=T)[order(gene, FDR), .(gene, shRNA, score, logFC, FDR)]
write.table(top_a375_PhenDC3vst0_scores, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PhenDC3vst0_shRNAs.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PhenDC3vst0_shRNAs.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/shRNAs_all")

# SA100128vst0
top_a375_SA100128vst0_scores <- merge(top_a375_SA100128vst0, scores, by.x="shRNA", by.y="cshlid_ultra_id", all.x=T)[order(gene, FDR), .(gene, shRNA, score, logFC, FDR)]
write.table(top_a375_SA100128vst0_scores, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_SA100128vst0_shRNAs.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_SA100128vst0_shRNAs.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/shRNAs_all")



# Loss of genes analysis. This is better way of doing it than in 20161124_lost_genes.md

# Genes found in the raw table of counts (before filtering)
all_genes_counts <- data.table(table(as.character(z_a375$genes$gene))) # 1358 - 1352 = 6 genes not found in 20170120_Miniscreen_directory.fa

# Genes found in the raw table of counts (after filtering)
all_genes_filter <- data.table(table(as.character(top_a375_DMSOvst0$gene))) # 1352 - 1352 = 0 genes removed by t0 filtering

# Genes lost before filtering
genes_lost_before_filtering <- setdiff(all_genes$V1, all_genes_counts$V1)

# Genes lost after filtering
genes_lost_after_filtering <- setdiff(all_genes_counts$V1, all_genes_filter$V1)

# Combine and write output table
l <- list(data.table(gene = genes_lost_before_filtering), data.table(gene = genes_lost_after_filtering))
setattr(l, 'names', c("before_filtering", "after_filtering"))
l_combined <- rbindlist(l, idcol="lost")

write.table(setcolorder(l_combined, c("gene", "lost")), file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_genes_lost_t0_A375.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_genes_lost_t0_A375.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_lost")


#####################################
# DMSOvst0, PDSvst0 and PhenDC3vst0 #
#####################################

# Venn diagram resistant

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0, PDSvst0 and PhenDC3vst0
# DMSOvst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))
# PDSvst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))
# PhenDC3vst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))

venn.plot <- draw.triple.venn(
  area1 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0),
  area2 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0),
  area3 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0),
  n12 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0)),
  n23 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)),
  n13 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)),
  n123 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)),
  category = c(sprintf("PDS (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0)), sprintf("PhenDC3 (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0))),
  fill = c("red3", "forestgreen", "deepskyblue3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.dist = c(0.08, 0.08, 0.04),
  cat.cex = 1.5,
  cat.col = c("red3", "forestgreen", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_resistant_shRNAs.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_resistant_shRNAs.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0, PDSvst0 and PhenDC3vst0
# DMSOvst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))
# PDSvst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))
# PhenDC3vst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))

venn.plot <- draw.triple.venn(
  area1 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0),
  area2 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0),
  area3 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0),
  n12 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)),
  n23 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)),
  n13 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)),
  n123 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)),
  category = c(sprintf("PDS (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0)), sprintf("PhenDC3 (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0))),
  fill = c("red3", "forestgreen", "deepskyblue3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.dist = c(0.08, 0.08, 0.04),
  cat.cex = 1.5,
  cat.col = c("red3", "forestgreen", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser (same as above and logFC < -1)

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0, PDSvst0 and PhenDC3vst0
# DMSOvst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))
# PDSvst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))
# PhenDC3vst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))

venn.plot <- draw.triple.venn(
  area1 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0),
  area2 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0),
  area3 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0),
  n12 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)),
  n23 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)),
  n13 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)),
  n123 = length(intersect(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)),
  category = c(sprintf("PDS (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0)), sprintf("PhenDC3 (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0))),
  fill = c("red3", "forestgreen", "deepskyblue3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.dist = c(0.08, 0.08, 0.04),
  cat.cex = 1.5,
  cat.col = c("red3", "forestgreen", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_logFCminus1.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_logFCminus1.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser (shRNAs)

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant shRNAs for DMSOvst0, PDSvst0 and PhenDC3vst0
# DMSOvst0
topids_shRNAs_a375_DMSOvst0 <- top_a375_DMSOvst0[FDR <= 0.05 & logFC < 0]$shRNA
# PDSvst0
topids_shRNAs_a375_PDSvst0 <- top_a375_PDSvst0[FDR <= 0.05 & logFC < 0]$shRNA
# PhenDC3vst0
topids_shRNAs_a375_PhenDC3vst0 <- top_a375_PhenDC3vst0[FDR <= 0.05 & logFC < 0]$shRNA

venn.plot <- draw.triple.venn(
  area1 = length(topids_shRNAs_a375_PDSvst0),
  area2 = length(topids_shRNAs_a375_PhenDC3vst0),
  area3 = length(topids_shRNAs_a375_DMSOvst0),
  n12 = length(intersect(topids_shRNAs_a375_PDSvst0, topids_shRNAs_a375_PhenDC3vst0)),
  n23 = length(intersect(topids_shRNAs_a375_PhenDC3vst0, topids_shRNAs_a375_DMSOvst0)),
  n13 = length(intersect(topids_shRNAs_a375_PDSvst0, topids_shRNAs_a375_DMSOvst0)),
  n123 = length(intersect(intersect(topids_shRNAs_a375_PDSvst0, topids_shRNAs_a375_PhenDC3vst0), topids_shRNAs_a375_DMSOvst0)),
  category = c(sprintf("PDS (%i)", length(topids_shRNAs_a375_PDSvst0)), sprintf("PhenDC3 (%i)", length(topids_shRNAs_a375_PhenDC3vst0)), sprintf("DMSO (%i)", length(topids_shRNAs_a375_DMSOvst0))),
  fill = c("red3", "forestgreen", "deepskyblue3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.dist = c(0.08, 0.08, 0.04),
  cat.cex = 1.5,
  cat.col = c("red3", "forestgreen", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_shRNAs_A375_venn_FDR5minus2.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_shRNAs_A375_venn_FDR5minus2.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Tables of genes for PDS only, PhenDC3 only and PDS+PhenDC3 only with FDR <= 0.05 & logFC < 0 (sensitiser) or logFC > 0 (resistant) & passing the 50% or at least 3 threshold of significant shRNAS

# resistant
# PDS only
top_a375_PDSonly_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0))][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_a375_PDSonly_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PDSonly_resistant_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PDSonly_resistant_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PhenDC3 only
top_a375_PhenDC3only_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0))][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_a375_PhenDC3only_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PhenDC3only_resistant_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PhenDC3only_resistant_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PDS+PhenDC3 only
top_a375_PDSandPhenDC3only_PhenDC3_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_a375_PDSandPhenDC3only_PDS_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_a375_PDSandPhenDC3only_resistant <- merge(top_a375_PDSandPhenDC3only_PhenDC3_resistant, top_a375_PDSandPhenDC3only_PDS_resistant, by = c("gene", "n_detected_shRNAs"), suffixes = c(".PhenDC3", ".PDS"))[order(-logFC_significant_resistant_shRNAs_median.PhenDC3)]
write.table(top_a375_PDSandPhenDC3only_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PDSandPhenDC3only_resistant_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PDSandPhenDC3only_resistant_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# DMSO
top_a375_DMSO_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_a375_DMSO_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_DMSO_resistant_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_DMSO_resistant_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")


# sensitiser
# PDS only
top_a375_PDSonly_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0))][order(logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_a375_PDSonly_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PDSonly_sensitiser_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PDSonly_sensitiser_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PhenDC3 only
top_a375_PhenDC3only_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0))][order(logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_a375_PhenDC3only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PhenDC3only_sensitiser_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PhenDC3only_sensitiser_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PDS+PhenDC3 only
top_a375_PDSandPhenDC3only_PhenDC3_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)][order(logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_a375_PDSandPhenDC3only_PDS_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)][order(logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_a375_PDSandPhenDC3only_sensitiser <- merge(top_a375_PDSandPhenDC3only_PhenDC3_sensitiser, top_a375_PDSandPhenDC3only_PDS_sensitiser, by = c("gene", "n_detected_shRNAs"), suffixes = c(".PhenDC3", ".PDS"))[order(logFC_significant_sensitiser_shRNAs_median.PhenDC3)]
write.table(top_a375_PDSandPhenDC3only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PDSandPhenDC3only_sensitiser_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_PDSandPhenDC3only_sensitiser_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# DMSO
top_a375_DMSO_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][order(logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_a375_DMSO_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_DMSO_sensitiser_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_A375_DMSO_sensitiser_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")




###################################################
# DMSOvst0, PDSvst0, PhenDC3vst0 and SA100128vst0 #
###################################################

# Venn diagram resistant

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0, PDSvst0, PhenDC3vst0 and SA100128vst0
# DMSOvst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))
# PDSvst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))
# PhenDC3vst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))
# SA100128vst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))

venn.plot <- draw.quad.venn(
  area1 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0),
  area2 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0),
  area3 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0),
  area4 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0),
  n12 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)),
  n13 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0)),
  n14 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0)),
  n23 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0)),
  n24 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0)),
  n34 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0)),
  n123 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0)),
  n124 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0)),
  n134 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0)),
  n234 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0)),
  n1234 = length(intersect(intersect(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0)),
  category = c(sprintf("PDS (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)), sprintf("PhenDC3 (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0)), sprintf("SA100128 (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0))),
  fill = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.cex = 1.5,
  cat.col = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = "raw",
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_resistant_shRNAs_includingSA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_resistant_shRNAs_includingSA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0, PDSvst0, PhenDC3vst0 and SA100128vst0
# DMSOvst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))
# PDSvst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))
# PhenDC3vst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))
# SA100128vst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))

venn.plot <- draw.quad.venn(
  area1 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0),
  area2 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0),
  area3 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0),
  area4 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0),
  n12 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)),
  n13 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)),
  n14 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  n23 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)),
  n24 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  n34 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  n123 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)),
  n124 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  n134 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  n234 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  n1234 = length(intersect(intersect(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  category = c(sprintf("PDS (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)), sprintf("PhenDC3 (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)), sprintf("SA100128 (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0))),
  fill = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.cex = 1.5,
  cat.col = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = "raw",
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_includingSA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_includingSA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser (same as above and logFC < -1)

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0, PDSvst0, PhenDC3vst0 and SA100128vst0
# DMSOvst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))
# PDSvst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))
# PhenDC3vst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))
# SA100128vst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))

venn.plot <- draw.quad.venn(
  area1 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0),
  area2 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0),
  area3 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0),
  area4 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0),
  n12 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)),
  n13 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)),
  n14 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  n23 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)),
  n24 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  n34 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  n123 = length(intersect(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)),
  n124 = length(intersect(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  n134 = length(intersect(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  n234 = length(intersect(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  n1234 = length(intersect(intersect(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  category = c(sprintf("PDS (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PDSvst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)), sprintf("PhenDC3 (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)), sprintf("SA100128 (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0))),
  fill = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.cex = 1.5,
  cat.col = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = "raw",
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_logFCminus1_includingSA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_logFCminus1_includingSA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser (shRNAs)

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant shRNAs for DMSOvst0, PDSvst0, PhenDC3vst0 and SA100128vst0
# DMSOvst0
topids_shRNAs_a375_DMSOvst0 <- top_a375_DMSOvst0[FDR <= 0.05 & logFC < 0]$shRNA
# PDSvst0
topids_shRNAs_a375_PDSvst0 <- top_a375_PDSvst0[FDR <= 0.05 & logFC < 0]$shRNA
# PhenDC3vst0
topids_shRNAs_a375_PhenDC3vst0 <- top_a375_PhenDC3vst0[FDR <= 0.05 & logFC < 0]$shRNA
# SA100128vst0
topids_shRNAs_a375_SA100128vst0 <- top_a375_SA100128vst0[FDR <= 0.05 & logFC < 0]$shRNA

venn.plot <- draw.quad.venn(
  area1 = length(topids_shRNAs_a375_PDSvst0),
  area2 = length(topids_shRNAs_a375_DMSOvst0),
  area3 = length(topids_shRNAs_a375_PhenDC3vst0),
  area4 = length(topids_shRNAs_a375_SA100128vst0),
  n12 = length(intersect(topids_shRNAs_a375_PDSvst0, topids_shRNAs_a375_DMSOvst0)),
  n13 = length(intersect(topids_shRNAs_a375_PDSvst0, topids_shRNAs_a375_PhenDC3vst0)),
  n14 = length(intersect(topids_shRNAs_a375_PDSvst0, topids_shRNAs_a375_SA100128vst0)),
  n23 = length(intersect(topids_shRNAs_a375_DMSOvst0, topids_shRNAs_a375_PhenDC3vst0)),
  n24 = length(intersect(topids_shRNAs_a375_DMSOvst0, topids_shRNAs_a375_SA100128vst0)),
  n34 = length(intersect(topids_shRNAs_a375_PhenDC3vst0, topids_shRNAs_a375_SA100128vst0)),
  n123 = length(intersect(intersect(topids_shRNAs_a375_PDSvst0, topids_shRNAs_a375_DMSOvst0), topids_shRNAs_a375_PhenDC3vst0)),
  n124 = length(intersect(intersect(topids_shRNAs_a375_PDSvst0, topids_shRNAs_a375_DMSOvst0), topids_shRNAs_a375_SA100128vst0)),
  n134 = length(intersect(intersect(topids_shRNAs_a375_PDSvst0, topids_shRNAs_a375_PhenDC3vst0), topids_shRNAs_a375_SA100128vst0)),
  n234 = length(intersect(intersect(topids_shRNAs_a375_DMSOvst0, topids_shRNAs_a375_PhenDC3vst0), topids_shRNAs_a375_SA100128vst0)),
  n1234 = length(intersect(intersect(intersect(topids_shRNAs_a375_PDSvst0, topids_shRNAs_a375_DMSOvst0), topids_shRNAs_a375_PhenDC3vst0), topids_shRNAs_a375_SA100128vst0)),
  category = c(sprintf("PDS (%i)", length(topids_shRNAs_a375_PDSvst0)), sprintf("DMSO (%i)", length(topids_shRNAs_a375_DMSOvst0)), sprintf("PhenDC3 (%i)", length(topids_shRNAs_a375_PhenDC3vst0)), sprintf("SA100128 (%i)", length(topids_shRNAs_a375_SA100128vst0))),
  fill = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.cex = 1.5,
  cat.col = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = "raw",
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_shRNAs_A375_venn_FDR5minus2_includingSA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_shRNAs_A375_venn_FDR5minus2_includingSA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Tables of genes for PDS only, PhenDC3 only, SA100128 only, PDS+PhenDC3 only, PDS+SA100128 only, PhenDC3+SA100128 only and PDS+PhenDC3+SA100128 only with FDR <= 0.05 & logFC < 0 (sensitiser) or logFC > 0 (resistant) & passing the 50% or at least 3 threshold of significant shRNAS

# resistant
# PDS only
top_a375_PDSonly_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0))][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_a375_PDSonly_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSonly_resistant_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSonly_resistant_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PhenDC3 only
top_a375_PhenDC3only_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0))][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_a375_PhenDC3only_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PhenDC3only_resistant_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PhenDC3only_resistant_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# SA100128 only
top_a375_SA100128only_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0))][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_a375_SA100128only_resistant # empty

# PDS+PhenDC3 only
top_a375_PDSandPhenDC3only_PhenDC3_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_a375_PDSandPhenDC3only_PDS_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_a375_PDSandPhenDC3only_resistant <- merge(top_a375_PDSandPhenDC3only_PhenDC3_resistant, top_a375_PDSandPhenDC3only_PDS_resistant, by = c("gene", "n_detected_shRNAs"), suffixes = c(".PhenDC3", ".PDS"))[order(-logFC_significant_resistant_shRNAs_median.PhenDC3)]
write.table(top_a375_PDSandPhenDC3only_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSandPhenDC3only_resistant_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSandPhenDC3only_resistant_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PDS+SA100128 only
top_a375_PDSandSA100128only_SA100128_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_a375_PDSandSA100128only_PDS_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_a375_PDSandSA100128only_resistant <- merge(top_a375_PDSandSA100128only_SA100128_resistant, top_a375_PDSandSA100128only_PDS_resistant, by = c("gene", "n_detected_shRNAs"), suffixes = c(".SA100128", ".PDS"))[order(-logFC_significant_resistant_shRNAs_median.SA100128)]
write.table(top_a375_PDSandSA100128only_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSandSA100128only_resistant_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSandSA100128only_resistant_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PhenDC3+SA100128 only
top_a375_PhenDC3andSA100128only_SA100128_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_a375_PhenDC3andSA100128only_SA100128_resistant # empty
top_a375_PhenDC3andSA100128only_PhenDC3_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_a375_PhenDC3andSA100128only_PhenDC3_resistant # empty

# PDS+PhenDC3+SA100128 only
top_a375_PDSandPhenDC3andSA100128only_SA100128_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0)][gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_a375_PDSandPhenDC3andSA100128only_PDS_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0)][gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PhenDC3vst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_a375_PDSandPhenDC3andSA100128only_PhenDC3_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0)][gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_PDSvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_a375_PDSandPhenDC3andSA100128only_tmp_resistant <- merge(top_a375_PDSandPhenDC3andSA100128only_SA100128_resistant, top_a375_PDSandPhenDC3andSA100128only_PDS_resistant, by = c("gene", "n_detected_shRNAs"), suffixes = c(".SA100128", ".PDS"))
top_a375_PDSandPhenDC3andSA100128only_resistant <- merge(top_a375_PDSandPhenDC3andSA100128only_PhenDC3_resistant, top_a375_PDSandPhenDC3andSA100128only_tmp_resistant, by = c("gene", "n_detected_shRNAs"))[order(-logFC_significant_resistant_shRNAs_median)]
write.table(top_a375_PDSandPhenDC3andSA100128only_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSandPhenDC3andSA100128only_resistant_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSandPhenDC3andSA100128only_resistant_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# DMSO
top_a375_DMSO_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_a375_DMSO_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_DMSO_resistant_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_DMSO_resistant_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")


# sensitiser
# PDS only
top_a375_PDSonly_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0))][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_a375_PDSonly_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSonly_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSonly_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PhenDC3 only
top_a375_PhenDC3only_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0))][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_a375_PhenDC3only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PhenDC3only_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PhenDC3only_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# SA100128 only
top_a375_SA100128only_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0))][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_a375_SA100128only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_SA100128only_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_SA100128only_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PDS+PhenDC3 only
top_a375_PDSandPhenDC3only_PhenDC3_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_a375_PDSandPhenDC3only_PDS_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_a375_PDSandPhenDC3only_sensitiser <- merge(top_a375_PDSandPhenDC3only_PhenDC3_sensitiser, top_a375_PDSandPhenDC3only_PDS_sensitiser, by = c("gene", "n_detected_shRNAs"), suffixes = c(".PhenDC3", ".PDS"))[order(-logFC_significant_sensitiser_shRNAs_median.PhenDC3)]
write.table(top_a375_PDSandPhenDC3only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSandPhenDC3only_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSandPhenDC3only_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PDS+SA100128 only
top_a375_PDSandSA100128only_SA100128_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_a375_PDSandSA100128only_PDS_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_a375_PDSandSA100128only_sensitiser <- merge(top_a375_PDSandSA100128only_SA100128_sensitiser, top_a375_PDSandSA100128only_PDS_sensitiser, by = c("gene", "n_detected_shRNAs"), suffixes = c(".SA100128", ".PDS"))[order(-logFC_significant_sensitiser_shRNAs_median.SA100128)]
write.table(top_a375_PDSandSA100128only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSandSA100128only_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSandSA100128only_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PhenDC3+SA100128 only
top_a375_PhenDC3andSA100128only_SA100128_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_a375_PhenDC3andSA100128only_PhenDC3_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_a375_PhenDC3andSA100128only_sensitiser <- merge(top_a375_PhenDC3andSA100128only_SA100128_sensitiser, top_a375_PhenDC3andSA100128only_PhenDC3_sensitiser, by = c("gene", "n_detected_shRNAs"), suffixes = c(".SA100128", ".PhenDC3"))[order(-logFC_significant_sensitiser_shRNAs_median.SA100128)]
write.table(top_a375_PhenDC3andSA100128only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PhenDC3andSA100128only_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PhenDC3andSA100128only_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PDS+PhenDC3+SA100128 only
top_a375_PDSandPhenDC3andSA100128only_SA100128_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0)][gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_a375_PDSandPhenDC3andSA100128only_PDS_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)][gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PhenDC3vst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_a375_PDSandPhenDC3andSA100128only_PhenDC3_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)][gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_PDSvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_a375_PDSandPhenDC3andSA100128only_tmp_sensitiser <- merge(top_a375_PDSandPhenDC3andSA100128only_SA100128_sensitiser, top_a375_PDSandPhenDC3andSA100128only_PDS_sensitiser, by = c("gene", "n_detected_shRNAs"), suffixes = c(".SA100128", ".PDS"))
top_a375_PDSandPhenDC3andSA100128only_sensitiser <- merge(top_a375_PDSandPhenDC3andSA100128only_PhenDC3_sensitiser, top_a375_PDSandPhenDC3andSA100128only_tmp_sensitiser, by = c("gene", "n_detected_shRNAs"))[order(-logFC_significant_sensitiser_shRNAs_median)]
write.table(top_a375_PDSandPhenDC3andSA100128only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSandPhenDC3andSA100128only_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PDSandPhenDC3andSA100128only_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# DMSO
top_a375_DMSO_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_a375_DMSO_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_DMSO_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_DMSO_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")




#############################
# DMSOvst0 and SA100128vst0 #
#############################

# Venn diagram resistant

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0 and SA100128vst0
# DMSOvst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))
# SA100128vst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))

venn.plot <- draw.pairwise.venn(
  area1 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0),
  area2 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0),
  cross.area = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0)),
  category = c(sprintf("SA100128 (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_SA100128vst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0))),
  scaled = FALSE,
  fill = c("goldenrod3", "deepskyblue3"),
  cex = 2,
  fontfamily = "sans",
  cat.pos = c(-20, 20),
  cat.dist = c(0.06, 0.06),
  cat.cex = 2,
  cat.col = c("goldenrod3", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_resistant_shRNAs_onlySA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_resistant_shRNAs_onlySA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0 and SA100128vst0
# DMSOvst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))
# SA100128vst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))

venn.plot <- draw.pairwise.venn(
  area1 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0),
  area2 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0),
  cross.area = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  category = c(sprintf("SA100128 (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0))),
  scaled = FALSE,
  fill = c("goldenrod3", "deepskyblue3"),
  cex = 2,
  fontfamily = "sans",
  cat.pos = c(-20, 20),
  cat.dist = c(0.06, 0.06),
  cat.cex = 2,
  cat.col = c("goldenrod3", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_onlySA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_onlySA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser (same as above and logFC < -1)

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0 and SA100128vst0
# DMSOvst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))
# SA100128vst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))

venn.plot <- draw.pairwise.venn(
  area1 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0),
  area2 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0),
  cross.area = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)),
  category = c(sprintf("SA100128 (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_SA100128vst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0))),
  scaled = FALSE,
  fill = c("goldenrod3", "deepskyblue3"),
  cex = 2,
  fontfamily = "sans",
  cat.pos = c(-20, 20),
  cat.dist = c(0.06, 0.06),
  cat.cex = 2,
  cat.col = c("goldenrod3", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_logFCminus1_onlySA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_genes_A375_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_logFCminus1_onlySA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser (shRNAs)

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant shRNAs for DMSOvst0 and SA100128vst0
# DMSOvst0
topids_shRNAs_a375_DMSOvst0 <- top_a375_DMSOvst0[FDR <= 0.05 & logFC < 0]$shRNA
# SA100128vst0
topids_shRNAs_a375_SA100128vst0 <- top_a375_SA100128vst0[FDR <= 0.05 & logFC < 0]$shRNA

venn.plot <- draw.pairwise.venn(
  area1 = length(topids_shRNAs_a375_SA100128vst0),
  area2 = length(topids_shRNAs_a375_DMSOvst0),
  cross.area = length(intersect(topids_shRNAs_a375_DMSOvst0, topids_shRNAs_a375_SA100128vst0)),
  category = c(sprintf("SA100128 (%i)", length(topids_shRNAs_a375_SA100128vst0)), sprintf("DMSO (%i)", length(topids_shRNAs_a375_DMSOvst0))),
  scaled = FALSE,
  fill = c("goldenrod3", "deepskyblue3"),
  cex = 2,
  fontfamily = "sans",
  cat.pos = c(-20, 20),
  cat.dist = c(0.06, 0.06),
  cat.cex = 2,
  cat.col = c("goldenrod3", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_shRNAs_A375_venn_FDR5minus2_onlySA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_shRNAs_A375_venn_FDR5minus2_onlySA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Tables of genes for SA100128 only with FDR <= 0.05 & logFC < 0 (sensitiser) or logFC > 0 (resistant) & passing the 50% or at least 3 threshold of significant shRNAS

# resistant
# SA100128 only
top_a375_SA100128only_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_a375_DMSOvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_a375_SA100128only_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_A375_SA100128only_resistant_genes_onlySA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_A375_SA100128only_resistant_genes_onlySA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# DMSO
top_a375_DMSO_resistant <- all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_a375_DMSO_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_A375_DMSO_resistant_genes_onlySA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_A375_DMSO_resistant_genes_onlySA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")


# sensitiser
# SA100128 only
top_a375_SA100128only_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_a375_DMSOvst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_a375_SA100128only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_A375_SA100128only_sensitiser_genes_onlySA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_A375_SA100128only_sensitiser_genes_onlySA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# DMSO
top_a375_DMSO_sensitiser <- all_detected_significant_resistant_sensitiser_genes_a375_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_a375_DMSO_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_A375_DMSO_sensitiser_genes_onlySA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_A375_DMSO_sensitiser_genes_onlySA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")








############
############
## HT1080 ##
############
############


# Distribution of the number of genes by the number of shRNAs
genes_dataframe <- data.frame(shRNA = rownames(z_ht1080), gene = as.character(sapply(rownames(z_ht1080), function(x) unlist(strsplit(x, "__"))[1])))
z_ht1080$genes <- genes_dataframe
z_ht1080["DHX36__sensor__1__ULTRA-3226137",]

gg <- ggplot(data.table(table(sort(table(z_ht1080$genes$gene)))), aes(x = as.numeric(V1), y = N)) +
geom_bar(stat="identity") +
xlab("Number of shRNAs") +
ylab("Number of genes") +
theme_classic()

ggsave("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170410_HT1080_numbershRNAs_numbergenes.pdf", width = 10/2.54, height = 10/2.54)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170410_HT1080_numbershRNAs_numbergenes.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/distribution")


# What are the genes with more different shRNAs detected?
head(sort(table(z_ht1080$genes$gene), decreasing = TRUE), n = 20)
#ERCC6   EIF4A2   RECQL5     AATK    ABCB1    ABCG8     ACO2    ACOXL    ACSL6    ACSS3    ACVR1   ACVR2B   ADAM17 ADAMTS15     ADAR    ADCK5    ADH1A    ADH1C     ADH4     ADH5
#    9        8        8        7        7        7        7        7        7        7        7        7        7        7        7        7        7        7        7        7


# Filtering
print(sprintf("shRNAs: %s", nrow(z_ht1080$counts))) # 7880
keep <- rowSums(cpm(z_ht1080[,1:3])>0.5) >= 3 # A library of 10M will need to have at least 5 counts in each of three t0 replicates individually in order to pass this filter
z_ht1080 <- z_ht1080[keep, , keep.lib.sizes=FALSE]
print(sprintf("shRNAs (after filtering): %s", nrow(z_ht1080$counts))) # 7486


# Normalisation
z_ht1080 <- calcNormFactors(z_ht1080)


# Differential representation analysis.
# Set up design matrix for GLM.
des <- model.matrix(~ 0 + group, data = z_ht1080$samples)
colnames(des) <- levels(factor(z_ht1080$samples$group))


# Estimate common dispersion
z_ht1080_glm <- estimateDisp(z_ht1080, des)
print(sprintf("Common dispersion: %s", sqrt(z_ht1080_glm$common.disp))) # 0.556445908948264


# Fit negative binomial GLM
z_ht1080_fit <- glmFit(z_ht1080_glm, des)


# Define matrix of contrasts
my.contrasts <- makeContrasts(
DMSOvst0 = t15_DMSO_HT1080 - t0_no_HT1080,
PDSvst0 = t15_PDS_HT1080 - t0_no_HT1080,
PhenDC3vst0 = t15_PhenDC3_HT1080 - t0_no_HT1080,
SA100128vst0 = t15_SA100128_HT1080 - t0_no_HT1080,
levels=des)


# Comparisons t15 vs t0
# Carry out Likelihood ratio tests
lrt_ht1080_DMSOvst0 <- glmLRT(z_ht1080_fit, contrast=my.contrasts[,"DMSOvst0"])
lrt_ht1080_PDSvst0 <- glmLRT(z_ht1080_fit, contrast=my.contrasts[,"PDSvst0"])
lrt_ht1080_PhenDC3vst0 <- glmLRT(z_ht1080_fit, contrast=my.contrasts[,"PhenDC3vst0"])
lrt_ht1080_SA100128vst0 <- glmLRT(z_ht1080_fit, contrast=my.contrasts[,"SA100128vst0"])


# Get ranked shRNAS and combine shRNAs into a table
## DMSOvst0
top_ht1080_DMSOvst0 <- data.table(topTags(lrt_ht1080_DMSOvst0, n=Inf)$table)[order(FDR),.(gene, shRNA, logFC, FDR)]
## PDSvst0
top_ht1080_PDSvst0 <- data.table(topTags(lrt_ht1080_PDSvst0, n=Inf)$table)[order(FDR),.(gene, shRNA, logFC, FDR)]
## PhenDC3vst0
top_ht1080_PhenDC3vst0 <- data.table(topTags(lrt_ht1080_PhenDC3vst0, n=Inf)$table)[order(FDR),.(gene, shRNA, logFC, FDR)]
## SA100128vst0
top_ht1080_SA100128vst0 <- data.table(topTags(lrt_ht1080_SA100128vst0, n=Inf)$table)[order(FDR),.(gene, shRNA, logFC, FDR)]



# Tables of genes by DMSOvst0, PDSvst0 and PhenDC3vst0 and for resistant (logFC>0) or sensitiser (logFC<0)

## DMSOvst0
detected_genes_ht1080_DMSOvst0 <- top_ht1080_DMSOvst0[,.(n_detected_shRNA = uniqueN(shRNA)), by = gene] # detected genes DMSOvst0, 1352, 6 genes with no shRNAs detected, shRNAs filtered are not included in this table either

all_detected_genes_ht1080_DMSOvst0 <- merge(all_genes, detected_genes_ht1080_DMSOvst0, by.x="V1", by.y="gene", all=T)
setnames(all_detected_genes_ht1080_DMSOvst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs"))

significant_resistant_genes_ht1080_DMSOvst0 <- top_ht1080_DMSOvst0[FDR <= 0.05 & logFC > 0,.(n_significant_resistant_shRNAs = uniqueN(shRNA), logFC_significant_resistant_shRNAs_average = mean(logFC), FC_significant_resistant_shRNAs_average = 2^(mean(logFC)), logFC_significant_resistant_shRNAs_median = median(logFC), FC_significant_resistant_shRNAs_median = 2^(median(logFC))), by = gene] # significant and resistant genes DMSOvst0, 355
significant_sensitiser_genes_ht1080_DMSOvst0 <- top_ht1080_DMSOvst0[FDR <= 0.05 & logFC < 0,.(n_significant_sensitiser_shRNAs = uniqueN(shRNA), logFC_significant_sensitiser_shRNAs_average = mean(logFC), FC_significant_sensitiser_shRNAs_average = 2^(mean(logFC)), logFC_significant_sensitiser_shRNAs_median = median(logFC), FC_significant_sensitiser_shRNAs_median = 2^(median(logFC))), by = gene] # significant and sensitiser genes DMSOvst0, 272
length(intersect(significant_resistant_genes_ht1080_DMSOvst0$gene, significant_sensitiser_genes_ht1080_DMSOvst0$gene)) # 36

all_detected_significant_resistant_genes_ht1080_DMSOvst0 <- merge(all_detected_genes_ht1080_DMSOvst0, significant_resistant_genes_ht1080_DMSOvst0, by.x="gene", by.y="gene", all=T)
all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0 <- merge(all_detected_significant_resistant_genes_ht1080_DMSOvst0, significant_sensitiser_genes_ht1080_DMSOvst0, by.x="gene", by.y="gene", all=T)

for (j in c("n_detected_shRNAs", "n_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs")){
  set(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0, which(is.na(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[[j]])),j,0)
}

all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[, pct_significant_resistant_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_resistant_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[, pass_50_threshold_significant_resistant_shRNAs := ifelse(pct_significant_resistant_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[, pass_3_significant_resistant_shRNAs := ifelse(n_significant_resistant_shRNAs >= 3, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[, pct_significant_sensitiser_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_sensitiser_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[, pass_50_threshold_significant_sensitiser_shRNAs := ifelse(pct_significant_sensitiser_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[, pass_3_significant_sensitiser_shRNAs := ifelse(n_significant_sensitiser_shRNAs >= 3, "yes", "no")]

setcolorder(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs", "n_significant_resistant_shRNAs", "logFC_significant_resistant_shRNAs_average", "FC_significant_resistant_shRNAs_average", "logFC_significant_resistant_shRNAs_median", "FC_significant_resistant_shRNAs_median", "pct_significant_resistant_shRNAs", "pass_50_threshold_significant_resistant_shRNAs", "pass_3_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs", "logFC_significant_sensitiser_shRNAs_average", "FC_significant_sensitiser_shRNAs_average", "logFC_significant_sensitiser_shRNAs_median", "FC_significant_sensitiser_shRNAs_median", "pct_significant_sensitiser_shRNAs", "pass_50_threshold_significant_sensitiser_shRNAs", "pass_3_significant_sensitiser_shRNAs"))

all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0["DHX36"]
#gene n_total_shRNAs n_detected_shRNAs n_significant_resistant_shRNAs logFC_significant_resistant_shRNAs_average FC_significant_resistant_shRNAs_average logFC_significant_resistant_shRNAs_median FC_significant_resistant_shRNAs_median
#1: DHX36              7                 7                              0                                         NA                                      NA                                        NA                                     NA
#pct_significant_resistant_shRNAs pass_50_threshold_significant_resistant_shRNAs pass_3_significant_resistant_shRNAs n_significant_sensitiser_shRNAs logFC_significant_sensitiser_shRNAs_average FC_significant_sensitiser_shRNAs_average
#1:                                0                                             no                                  no                               0                                          NA                                       NA
#logFC_significant_sensitiser_shRNAs_median FC_significant_sensitiser_shRNAs_median pct_significant_sensitiser_shRNAs pass_50_threshold_significant_sensitiser_shRNAs pass_3_significant_sensitiser_shRNAs
#1:                                         NA                                      NA                                 0                                              no                                   no

nrow(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]) # 43 genes are resistant in DMSOvst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC > 0
nrow(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]) # 35 genes are sensitiser in DMSOvst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC < 0
nrow(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[(pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes") & (pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes")]) # 0 genes are both resistant and sensitiser in DMSOvst0

write.table(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_DMSOvst0_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_DMSOvst0_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_all")

## PDSvst0
detected_genes_ht1080_PDSvst0 <- top_ht1080_PDSvst0[,.(n_detected_shRNA = uniqueN(shRNA)), by = gene] # detected genes PDSvst0, 1352, 6 genes with no shRNAs detected, shRNAs filtered are not included in this table either

all_detected_genes_ht1080_PDSvst0 <- merge(all_genes, detected_genes_ht1080_PDSvst0, by.x="V1", by.y="gene", all=T)
setnames(all_detected_genes_ht1080_PDSvst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs"))

significant_resistant_genes_ht1080_PDSvst0 <- top_ht1080_PDSvst0[FDR <= 0.05 & logFC > 0,.(n_significant_resistant_shRNAs = uniqueN(shRNA), logFC_significant_resistant_shRNAs_average = mean(logFC), FC_significant_resistant_shRNAs_average = 2^(mean(logFC)), logFC_significant_resistant_shRNAs_median = median(logFC), FC_significant_resistant_shRNAs_median = 2^(median(logFC))), by = gene] # significant and resistant genes PDSvst0, 779
significant_sensitiser_genes_ht1080_PDSvst0 <- top_ht1080_PDSvst0[FDR <= 0.05 & logFC < 0,.(n_significant_sensitiser_shRNAs = uniqueN(shRNA), logFC_significant_sensitiser_shRNAs_average = mean(logFC), FC_significant_sensitiser_shRNAs_average = 2^(mean(logFC)), logFC_significant_sensitiser_shRNAs_median = median(logFC), FC_significant_sensitiser_shRNAs_median = 2^(median(logFC))), by = gene] # significant and sensitiser genes PDSvst0, 536
length(intersect(significant_resistant_genes_ht1080_PDSvst0$gene, significant_sensitiser_genes_ht1080_PDSvst0$gene)) # 239

all_detected_significant_resistant_genes_ht1080_PDSvst0 <- merge(all_detected_genes_ht1080_PDSvst0, significant_resistant_genes_ht1080_PDSvst0, by.x="gene", by.y="gene", all=T)
all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0 <- merge(all_detected_significant_resistant_genes_ht1080_PDSvst0, significant_sensitiser_genes_ht1080_PDSvst0, by.x="gene", by.y="gene", all=T)

for (j in c("n_detected_shRNAs", "n_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs")){
  set(all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0, which(is.na(all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[[j]])),j,0)
}

all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[, pct_significant_resistant_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_resistant_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[, pass_50_threshold_significant_resistant_shRNAs := ifelse(pct_significant_resistant_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[, pass_3_significant_resistant_shRNAs := ifelse(n_significant_resistant_shRNAs >= 3, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[, pct_significant_sensitiser_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_sensitiser_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[, pass_50_threshold_significant_sensitiser_shRNAs := ifelse(pct_significant_sensitiser_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[, pass_3_significant_sensitiser_shRNAs := ifelse(n_significant_sensitiser_shRNAs >= 3, "yes", "no")]

setcolorder(all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs", "n_significant_resistant_shRNAs", "logFC_significant_resistant_shRNAs_average", "FC_significant_resistant_shRNAs_average", "logFC_significant_resistant_shRNAs_median", "FC_significant_resistant_shRNAs_median", "pct_significant_resistant_shRNAs", "pass_50_threshold_significant_resistant_shRNAs", "pass_3_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs", "logFC_significant_sensitiser_shRNAs_average", "FC_significant_sensitiser_shRNAs_average", "logFC_significant_sensitiser_shRNAs_median", "FC_significant_sensitiser_shRNAs_median", "pct_significant_sensitiser_shRNAs", "pass_50_threshold_significant_sensitiser_shRNAs", "pass_3_significant_sensitiser_shRNAs"))

all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0["DHX36"]
#gene n_total_shRNAs n_detected_shRNAs n_significant_resistant_shRNAs logFC_significant_resistant_shRNAs_average FC_significant_resistant_shRNAs_average logFC_significant_resistant_shRNAs_median FC_significant_resistant_shRNAs_median
#1: DHX36              7                 7                              1                                   3.928698                                15.22846                                  3.928698                               15.22846
#pct_significant_resistant_shRNAs pass_50_threshold_significant_resistant_shRNAs pass_3_significant_resistant_shRNAs n_significant_sensitiser_shRNAs logFC_significant_sensitiser_shRNAs_average FC_significant_sensitiser_shRNAs_average
#1:                         14.28571                                             no                                  no                               1                                   -2.841894                                0.1394777
#logFC_significant_sensitiser_shRNAs_median FC_significant_sensitiser_shRNAs_median pct_significant_sensitiser_shRNAs pass_50_threshold_significant_sensitiser_shRNAs pass_3_significant_sensitiser_shRNAs
#1:                                  -2.841894                               0.1394777                          14.28571                                              no                                   no

nrow(all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]) # 185 genes are resistant in PDSvst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC > 0
nrow(all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]) # 105 genes are sensitiser in PDSvst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC < 0
nrow(all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[(pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes") & (pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes")]) # 0 genes are both resistant and sensitiser in PDSvst0

write.table(all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PDSvst0_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PDSvst0_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_all")

## PhenDC3vst0
detected_genes_ht1080_PhenDC3vst0 <- top_ht1080_PhenDC3vst0[,.(n_detected_shRNA = uniqueN(shRNA)), by = gene] # detected genes PhenDC3vst0, 1352, 6 genes with no shRNAs detected, shRNAs filtered are not included in this table either

all_detected_genes_ht1080_PhenDC3vst0 <- merge(all_genes, detected_genes_ht1080_PhenDC3vst0, by.x="V1", by.y="gene", all=T)
setnames(all_detected_genes_ht1080_PhenDC3vst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs"))

significant_resistant_genes_ht1080_PhenDC3vst0 <- top_ht1080_PhenDC3vst0[FDR <= 0.05 & logFC > 0,.(n_significant_resistant_shRNAs = uniqueN(shRNA), logFC_significant_resistant_shRNAs_average = mean(logFC), FC_significant_resistant_shRNAs_average = 2^(mean(logFC)), logFC_significant_resistant_shRNAs_median = median(logFC), FC_significant_resistant_shRNAs_median = 2^(median(logFC))), by = gene] # significant and resistant genes PhenDC3vst0, 459
significant_sensitiser_genes_ht1080_PhenDC3vst0 <- top_ht1080_PhenDC3vst0[FDR <= 0.05 & logFC < 0,.(n_significant_sensitiser_shRNAs = uniqueN(shRNA), logFC_significant_sensitiser_shRNAs_average = mean(logFC), FC_significant_sensitiser_shRNAs_average = 2^(mean(logFC)), logFC_significant_sensitiser_shRNAs_median = median(logFC), FC_significant_sensitiser_shRNAs_median = 2^(median(logFC))), by = gene] # significant and sensitiser genes PhenDC3vst0, 336
length(intersect(significant_resistant_genes_ht1080_PhenDC3vst0$gene, significant_sensitiser_genes_ht1080_PhenDC3vst0$gene)) # 51

all_detected_significant_resistant_genes_ht1080_PhenDC3vst0 <- merge(all_detected_genes_ht1080_PhenDC3vst0, significant_resistant_genes_ht1080_PhenDC3vst0, by.x="gene", by.y="gene", all=T)
all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0 <- merge(all_detected_significant_resistant_genes_ht1080_PhenDC3vst0, significant_sensitiser_genes_ht1080_PhenDC3vst0, by.x="gene", by.y="gene", all=T)

for (j in c("n_detected_shRNAs", "n_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs")){
  set(all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0, which(is.na(all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[[j]])),j,0)
}

all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[, pct_significant_resistant_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_resistant_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[, pass_50_threshold_significant_resistant_shRNAs := ifelse(pct_significant_resistant_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[, pass_3_significant_resistant_shRNAs := ifelse(n_significant_resistant_shRNAs >= 3, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[, pct_significant_sensitiser_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_sensitiser_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[, pass_50_threshold_significant_sensitiser_shRNAs := ifelse(pct_significant_sensitiser_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[, pass_3_significant_sensitiser_shRNAs := ifelse(n_significant_sensitiser_shRNAs >= 3, "yes", "no")]

setcolorder(all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs", "n_significant_resistant_shRNAs", "logFC_significant_resistant_shRNAs_average", "FC_significant_resistant_shRNAs_average",  "logFC_significant_resistant_shRNAs_median", "FC_significant_resistant_shRNAs_median", "pct_significant_resistant_shRNAs", "pass_50_threshold_significant_resistant_shRNAs", "pass_3_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs", "logFC_significant_sensitiser_shRNAs_average", "FC_significant_sensitiser_shRNAs_average", "logFC_significant_sensitiser_shRNAs_median", "FC_significant_sensitiser_shRNAs_median", "pct_significant_sensitiser_shRNAs", "pass_50_threshold_significant_sensitiser_shRNAs", "pass_3_significant_sensitiser_shRNAs"))

all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0["DHX36"]
#gene n_total_shRNAs n_detected_shRNAs n_significant_resistant_shRNAs logFC_significant_resistant_shRNAs_average FC_significant_resistant_shRNAs_average logFC_significant_resistant_shRNAs_median FC_significant_resistant_shRNAs_median
#1: DHX36              7                 7                              0                                         NA                                      NA                                        NA                                     NA
#pct_significant_resistant_shRNAs pass_50_threshold_significant_resistant_shRNAs pass_3_significant_resistant_shRNAs n_significant_sensitiser_shRNAs logFC_significant_sensitiser_shRNAs_average FC_significant_sensitiser_shRNAs_average
#1:                                0                                             no                                  no                               2                                   -3.427972                               0.09291322
#logFC_significant_sensitiser_shRNAs_median FC_significant_sensitiser_shRNAs_median pct_significant_sensitiser_shRNAs pass_50_threshold_significant_sensitiser_shRNAs pass_3_significant_sensitiser_shRNAs
#1:                                  -3.427972                              0.09291322                          28.57143                                              no                                   no

nrow(all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]) # 52 genes are resistant in PhenDC3vst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC > 0
nrow(all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]) # 75 genes are sensitiser in PhenDC3vst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC < 0
nrow(all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[(pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes") & (pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes")]) # 0 genes are both resistant and sensitiser in PhenDC3vst0 at the same time

write.table(all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PhenDC3vst0_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PhenDC3vst0_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_all")

## SA100128vst0
detected_genes_ht1080_SA100128vst0 <- top_ht1080_SA100128vst0[,.(n_detected_shRNA = uniqueN(shRNA)), by = gene] # detected genes SA100128vst0, 1352, 6 genes with no shRNAs detected, shRNAs filtered are not included in this table either

all_detected_genes_ht1080_SA100128vst0 <- merge(all_genes, detected_genes_ht1080_SA100128vst0, by.x="V1", by.y="gene", all=T)
setnames(all_detected_genes_ht1080_SA100128vst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs"))

significant_resistant_genes_ht1080_SA100128vst0 <- top_ht1080_SA100128vst0[FDR <= 0.05 & logFC > 0,.(n_significant_resistant_shRNAs = uniqueN(shRNA), logFC_significant_resistant_shRNAs_average = mean(logFC), FC_significant_resistant_shRNAs_average = 2^(mean(logFC)), logFC_significant_resistant_shRNAs_median = median(logFC), FC_significant_resistant_shRNAs_median = 2^(median(logFC))), by = gene] # significant and resistant genes SA100128vst0, 152
significant_sensitiser_genes_ht1080_SA100128vst0 <- top_ht1080_SA100128vst0[FDR <= 0.05 & logFC < 0,.(n_significant_sensitiser_shRNAs = uniqueN(shRNA), logFC_significant_sensitiser_shRNAs_average = mean(logFC), FC_significant_sensitiser_shRNAs_average = 2^(mean(logFC)), logFC_significant_sensitiser_shRNAs_median = median(logFC), FC_significant_sensitiser_shRNAs_median = 2^(median(logFC))), by = gene] # significant and sensitiser genes SA100128vst0, 154
length(intersect(significant_resistant_genes_ht1080_SA100128vst0$gene, significant_sensitiser_genes_ht1080_SA100128vst0$gene)) # 7

all_detected_significant_resistant_genes_ht1080_SA100128vst0 <- merge(all_detected_genes_ht1080_SA100128vst0, significant_resistant_genes_ht1080_SA100128vst0, by.x="gene", by.y="gene", all=T)
all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0 <- merge(all_detected_significant_resistant_genes_ht1080_SA100128vst0, significant_sensitiser_genes_ht1080_SA100128vst0, by.x="gene", by.y="gene", all=T)

for (j in c("n_detected_shRNAs", "n_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs")){
  set(all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0, which(is.na(all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[[j]])),j,0)
}

all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[, pct_significant_resistant_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_resistant_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[, pass_50_threshold_significant_resistant_shRNAs := ifelse(pct_significant_resistant_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[, pass_3_significant_resistant_shRNAs := ifelse(n_significant_resistant_shRNAs >= 3, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[, pct_significant_sensitiser_shRNAs := ifelse(n_detected_shRNAs > 0, 100*n_significant_sensitiser_shRNAs/n_detected_shRNAs, 0)]
all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[, pass_50_threshold_significant_sensitiser_shRNAs := ifelse(pct_significant_sensitiser_shRNAs >= 50, "yes", "no")]
all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[, pass_3_significant_sensitiser_shRNAs := ifelse(n_significant_sensitiser_shRNAs >= 3, "yes", "no")]

setcolorder(all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0, c("gene", "n_total_shRNAs", "n_detected_shRNAs", "n_significant_resistant_shRNAs", "logFC_significant_resistant_shRNAs_average", "FC_significant_resistant_shRNAs_average",  "logFC_significant_resistant_shRNAs_median", "FC_significant_resistant_shRNAs_median", "pct_significant_resistant_shRNAs", "pass_50_threshold_significant_resistant_shRNAs", "pass_3_significant_resistant_shRNAs", "n_significant_sensitiser_shRNAs", "logFC_significant_sensitiser_shRNAs_average", "FC_significant_sensitiser_shRNAs_average", "logFC_significant_sensitiser_shRNAs_median", "FC_significant_sensitiser_shRNAs_median", "pct_significant_sensitiser_shRNAs", "pass_50_threshold_significant_sensitiser_shRNAs", "pass_3_significant_sensitiser_shRNAs"))

all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0["DHX36"]
#gene n_total_shRNAs n_detected_shRNAs n_significant_resistant_shRNAs logFC_significant_resistant_shRNAs_average FC_significant_resistant_shRNAs_average logFC_significant_resistant_shRNAs_median FC_significant_resistant_shRNAs_median
#1: DHX36              7                 7                              0                                         NA                                      NA                                        NA                                     NA
#pct_significant_resistant_shRNAs pass_50_threshold_significant_resistant_shRNAs pass_3_significant_resistant_shRNAs n_significant_sensitiser_shRNAs logFC_significant_sensitiser_shRNAs_average FC_significant_sensitiser_shRNAs_average
#1:                                0                                             no                                  no                               1                                   -3.042866                                0.1213406
#logFC_significant_sensitiser_shRNAs_median FC_significant_sensitiser_shRNAs_median pct_significant_sensitiser_shRNAs pass_50_threshold_significant_sensitiser_shRNAs pass_3_significant_sensitiser_shRNAs
#1:                                  -3.042866                               0.1213406                          14.28571                                              no                                   no

nrow(all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]) # 12 genes are resistant in SA100128vst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC > 0
nrow(all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]) # 12 genes are sensitiser in SA100128vst0, have more than 50% or at least 3 shRNAS detected with FDR <= 0.05 & logFC < 0
nrow(all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[(pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes") & (pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes")]) # 0 genes are both resistant and sensitiser in SA100128vst0 at the same time

write.table(all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_SA100128vst0_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_SA100128vst0_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_all")



# Tables of shRNAs by DMSOvst0, PDSvst0, PhenDC3vst0 and SA100128vst0 including transomic scores

# DMSOvst0
top_ht1080_DMSOvst0_scores <- merge(top_ht1080_DMSOvst0, scores, by.x="shRNA", by.y="cshlid_ultra_id", all.x=T)[order(gene, FDR), .(gene, shRNA, score, logFC, FDR)]
write.table(top_ht1080_DMSOvst0_scores, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_DMSOvst0_shRNAs.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_DMSOvst0_shRNAs.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/shRNAs_all")

# PDSvst0
top_ht1080_PDSvst0_scores <- merge(top_ht1080_PDSvst0, scores, by.x="shRNA", by.y="cshlid_ultra_id", all.x=T)[order(gene, FDR), .(gene, shRNA, score, logFC, FDR)]
write.table(top_ht1080_PDSvst0_scores, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PDSvst0_shRNAs.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PDSvst0_shRNAs.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/shRNAs_all")

# PhenDC3vst0
top_ht1080_PhenDC3vst0_scores <- merge(top_ht1080_PhenDC3vst0, scores, by.x="shRNA", by.y="cshlid_ultra_id", all.x=T)[order(gene, FDR), .(gene, shRNA, score, logFC, FDR)]
write.table(top_ht1080_PhenDC3vst0_scores, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PhenDC3vst0_shRNAs.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PhenDC3vst0_shRNAs.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/shRNAs_all")

# SA100128vst0
top_ht1080_SA100128vst0_scores <- merge(top_ht1080_SA100128vst0, scores, by.x="shRNA", by.y="cshlid_ultra_id", all.x=T)[order(gene, FDR), .(gene, shRNA, score, logFC, FDR)]
write.table(top_ht1080_SA100128vst0_scores, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_SA100128vst0_shRNAs.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_SA100128vst0_shRNAs.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/shRNAs_all")



# Loss of genes analysis. This is better way of doing it than in 20161124_lost_genes.md

# Genes found in the raw table of counts (before filtering)
all_genes_counts <- data.table(table(as.character(z_ht1080$genes$gene))) # 1358 - 1352 = 6 genes not found in 20170120_Miniscreen_directory.fa

# Genes found in the raw table of counts (after filtering)
all_genes_filter <- data.table(table(as.character(top_ht1080_DMSOvst0$gene))) # 1352 - 1352 = 0 genes removed by t0 filtering

# Genes lost before filtering
genes_lost_before_filtering <- setdiff(all_genes$V1, all_genes_counts$V1)

# Genes lost after filtering
genes_lost_after_filtering <- setdiff(all_genes_counts$V1, all_genes_filter$V1)

# Combine and write output table
l <- list(data.table(gene = genes_lost_before_filtering), data.table(gene = genes_lost_after_filtering))
setattr(l, 'names', c("before_filtering", "after_filtering"))
l_combined <- rbindlist(l, idcol="lost")

write.table(setcolorder(l_combined, c("gene", "lost")), file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_genes_lost_t0_HT1080.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_genes_lost_t0_HT1080.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_lost")



#####################################
# DMSOvst0, PDSvst0 and PhenDC3vst0 #
#####################################

# Venn diagram resistant

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0, PDSvst0 and PhenDC3vst0
# DMSOvst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))
# PDSvst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))
# PhenDC3vst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))

venn.plot <- draw.triple.venn(
  area1 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0),
  area2 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0),
  area3 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0),
  n12 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0)),
  n23 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)),
  n13 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)),
  n123 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)),
  category = c(sprintf("PDS (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0)), sprintf("PhenDC3 (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0))),
  fill = c("red3", "forestgreen", "deepskyblue3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.dist = c(0.08, 0.08, 0.04),
  cat.cex = 1.5,
  cat.col = c("red3", "forestgreen", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_resistant_shRNAs.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_resistant_shRNAs.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0, PDSvst0 and PhenDC3vst0
# DMSOvst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))
# PDSvst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))
# PhenDC3vst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))

venn.plot <- draw.triple.venn(
  area1 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0),
  area2 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0),
  area3 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0),
  n12 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)),
  n23 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)),
  n13 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)),
  n123 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)),
  category = c(sprintf("PDS (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0)), sprintf("PhenDC3 (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0))),
  fill = c("red3", "forestgreen", "deepskyblue3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.dist = c(0.08, 0.08, 0.04),
  cat.cex = 1.5,
  cat.col = c("red3", "forestgreen", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser (same as above and logFC < -1)

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0, PDSvst0 and PhenDC3vst0
# DMSOvst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))
# PDSvst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))
# PhenDC3vst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))

venn.plot <- draw.triple.venn(
  area1 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0),
  area2 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0),
  area3 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0),
  n12 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)),
  n23 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)),
  n13 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)),
  n123 = length(intersect(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)),
  category = c(sprintf("PDS (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0)), sprintf("PhenDC3 (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0))),
  fill = c("red3", "forestgreen", "deepskyblue3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.dist = c(0.08, 0.08, 0.04),
  cat.cex = 1.5,
  cat.col = c("red3", "forestgreen", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_logFCminus1.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_logFCminus1.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser (shRNAs)

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant shRNAs for DMSOvst0, PDSvst0 and PhenDC3vst0
# DMSOvst0
topids_shRNAs_ht1080_DMSOvst0 <- top_ht1080_DMSOvst0[FDR <= 0.05 & logFC < 0]$shRNA
# PDSvst0
topids_shRNAs_ht1080_PDSvst0 <- top_ht1080_PDSvst0[FDR <= 0.05 & logFC < 0]$shRNA
# PhenDC3vst0
topids_shRNAs_ht1080_PhenDC3vst0 <- top_ht1080_PhenDC3vst0[FDR <= 0.05 & logFC < 0]$shRNA

venn.plot <- draw.triple.venn(
  area1 = length(topids_shRNAs_ht1080_PDSvst0),
  area2 = length(topids_shRNAs_ht1080_PhenDC3vst0),
  area3 = length(topids_shRNAs_ht1080_DMSOvst0),
  n12 = length(intersect(topids_shRNAs_ht1080_PDSvst0, topids_shRNAs_ht1080_PhenDC3vst0)),
  n23 = length(intersect(topids_shRNAs_ht1080_PhenDC3vst0, topids_shRNAs_ht1080_DMSOvst0)),
  n13 = length(intersect(topids_shRNAs_ht1080_PDSvst0, topids_shRNAs_ht1080_DMSOvst0)),
  n123 = length(intersect(intersect(topids_shRNAs_ht1080_PDSvst0, topids_shRNAs_ht1080_PhenDC3vst0), topids_shRNAs_ht1080_DMSOvst0)),
  category = c(sprintf("PDS (%i)", length(topids_shRNAs_ht1080_PDSvst0)), sprintf("PhenDC3 (%i)", length(topids_shRNAs_ht1080_PhenDC3vst0)), sprintf("DMSO (%i)", length(topids_shRNAs_ht1080_DMSOvst0))),
  fill = c("red3", "forestgreen", "deepskyblue3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.dist = c(0.08, 0.08, 0.04),
  cat.cex = 1.5,
  cat.col = c("red3", "forestgreen", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_shRNAs_HT1080_venn_FDR5minus2.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170411_t15vst0_shRNAs_HT1080_venn_FDR5minus2.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Tables of genes for PDS only, PhenDC3 only and PDS+PhenDC3 only with FDR <= 0.05 & logFC < 0 (sensitiser) or logFC > 0 (resistant) & passing the 50% or at least 3 threshold of significant shRNAS

# resistant
# PDS only
top_ht1080_PDSonly_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0))][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_ht1080_PDSonly_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PDSonly_resistant_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PDSonly_resistant_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PhenDC3 only
top_ht1080_PhenDC3only_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0))][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_ht1080_PhenDC3only_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PhenDC3only_resistant_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PhenDC3only_resistant_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PDS+PhenDC3 only
top_ht1080_PDSandPhenDC3only_PhenDC3_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_ht1080_PDSandPhenDC3only_PDS_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_ht1080_PDSandPhenDC3only_resistant <- merge(top_ht1080_PDSandPhenDC3only_PhenDC3_resistant, top_ht1080_PDSandPhenDC3only_PDS_resistant, by = c("gene", "n_detected_shRNAs"), suffixes = c(".PhenDC3", ".PDS"))[order(-logFC_significant_resistant_shRNAs_median.PhenDC3)]
write.table(top_ht1080_PDSandPhenDC3only_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PDSandPhenDC3only_resistant_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PDSandPhenDC3only_resistant_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# DMSO
top_ht1080_DMSO_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_ht1080_DMSO_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_DMSO_resistant_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_DMSO_resistant_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")


# sensitiser
# PDS only
top_ht1080_PDSonly_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0))][order(logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_ht1080_PDSonly_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PDSonly_sensitiser_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PDSonly_sensitiser_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PhenDC3 only
top_ht1080_PhenDC3only_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0))][order(logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_ht1080_PhenDC3only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PhenDC3only_sensitiser_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PhenDC3only_sensitiser_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PDS+PhenDC3 only
top_ht1080_PDSandPhenDC3only_PhenDC3_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)][order(logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_ht1080_PDSandPhenDC3only_PDS_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)][order(logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_ht1080_PDSandPhenDC3only_sensitiser <- merge(top_ht1080_PDSandPhenDC3only_PhenDC3_sensitiser, top_ht1080_PDSandPhenDC3only_PDS_sensitiser, by = c("gene", "n_detected_shRNAs"), suffixes = c(".PhenDC3", ".PDS"))[order(logFC_significant_sensitiser_shRNAs_median.PhenDC3)]
write.table(top_ht1080_PDSandPhenDC3only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PDSandPhenDC3only_sensitiser_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_PDSandPhenDC3only_sensitiser_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# DMSO
top_ht1080_DMSO_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][order(logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_ht1080_DMSO_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_DMSO_sensitiser_genes.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170411_HT1080_DMSO_sensitiser_genes.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")






###################################################
# DMSOvst0, PDSvst0, PhenDC3vst0 and SA100128vst0 #
###################################################

# Venn diagram resistant

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0, PDSvst0, PhenDC3vst0 and SA100128vst0
# DMSOvst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))
# PDSvst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))
# PhenDC3vst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))
# SA100128vst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))

venn.plot <- draw.quad.venn(
  area1 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0),
  area2 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0),
  area3 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0),
  area4 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0),
  n12 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)),
  n13 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0)),
  n14 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0)),
  n23 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0)),
  n24 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0)),
  n34 = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0)),
  n123 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0)),
  n124 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0)),
  n134 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0)),
  n234 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0)),
  n1234 = length(intersect(intersect(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0)),
  category = c(sprintf("PDS (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)), sprintf("PhenDC3 (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0)), sprintf("SA100128 (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0))),
  fill = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.cex = 1.5,
  cat.col = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = "raw",
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_resistant_shRNAs_includingSA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_resistant_shRNAs_includingSA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0, PDSvst0, PhenDC3vst0 and SA100128vst0
# DMSOvst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))
# PDSvst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))
# PhenDC3vst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))
# SA100128vst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))

venn.plot <- draw.quad.venn(
  area1 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0),
  area2 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0),
  area3 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0),
  area4 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0),
  n12 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)),
  n13 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)),
  n14 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  n23 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)),
  n24 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  n34 = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  n123 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)),
  n124 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  n134 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  n234 = length(intersect(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  n1234 = length(intersect(intersect(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0), topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  category = c(sprintf("PDS (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)), sprintf("PhenDC3 (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)), sprintf("SA100128 (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0))),
  fill = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.cex = 1.5,
  cat.col = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = "raw",
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_includingSA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_includingSA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser (same as above and logFC < -1)

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0, PDSvst0, PhenDC3vst0 and SA100128vst0
# DMSOvst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))
# PDSvst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))
# PhenDC3vst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))
# SA100128vst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))

venn.plot <- draw.quad.venn(
  area1 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0),
  area2 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0),
  area3 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0),
  area4 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0),
  n12 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)),
  n13 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)),
  n14 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  n23 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)),
  n24 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  n34 = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  n123 = length(intersect(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)),
  n124 = length(intersect(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  n134 = length(intersect(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  n234 = length(intersect(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  n1234 = length(intersect(intersect(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0), topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  category = c(sprintf("PDS (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)), sprintf("PhenDC3 (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)), sprintf("SA100128 (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0))),
  fill = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.cex = 1.5,
  cat.col = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = "raw",
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_logFCminus1_includingSA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_logFCminus1_includingSA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser (shRNAs)

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant shRNAs for DMSOvst0, PDSvst0, PhenDC3vst0 and SA100128vst0
# DMSOvst0
topids_shRNAs_ht1080_DMSOvst0 <- top_ht1080_DMSOvst0[FDR <= 0.05 & logFC < 0]$shRNA
# PDSvst0
topids_shRNAs_ht1080_PDSvst0 <- top_ht1080_PDSvst0[FDR <= 0.05 & logFC < 0]$shRNA
# PhenDC3vst0
topids_shRNAs_ht1080_PhenDC3vst0 <- top_ht1080_PhenDC3vst0[FDR <= 0.05 & logFC < 0]$shRNA
# SA100128vst0
topids_shRNAs_ht1080_SA100128vst0 <- top_ht1080_SA100128vst0[FDR <= 0.05 & logFC < 0]$shRNA

venn.plot <- draw.quad.venn(
  area1 = length(topids_shRNAs_ht1080_PDSvst0),
  area2 = length(topids_shRNAs_ht1080_DMSOvst0),
  area3 = length(topids_shRNAs_ht1080_PhenDC3vst0),
  area4 = length(topids_shRNAs_ht1080_SA100128vst0),
  n12 = length(intersect(topids_shRNAs_ht1080_PDSvst0, topids_shRNAs_ht1080_DMSOvst0)),
  n13 = length(intersect(topids_shRNAs_ht1080_PDSvst0, topids_shRNAs_ht1080_PhenDC3vst0)),
  n14 = length(intersect(topids_shRNAs_ht1080_PDSvst0, topids_shRNAs_ht1080_SA100128vst0)),
  n23 = length(intersect(topids_shRNAs_ht1080_DMSOvst0, topids_shRNAs_ht1080_PhenDC3vst0)),
  n24 = length(intersect(topids_shRNAs_ht1080_DMSOvst0, topids_shRNAs_ht1080_SA100128vst0)),
  n34 = length(intersect(topids_shRNAs_ht1080_PhenDC3vst0, topids_shRNAs_ht1080_SA100128vst0)),
  n123 = length(intersect(intersect(topids_shRNAs_ht1080_PDSvst0, topids_shRNAs_ht1080_DMSOvst0), topids_shRNAs_ht1080_PhenDC3vst0)),
  n124 = length(intersect(intersect(topids_shRNAs_ht1080_PDSvst0, topids_shRNAs_ht1080_DMSOvst0), topids_shRNAs_ht1080_SA100128vst0)),
  n134 = length(intersect(intersect(topids_shRNAs_ht1080_PDSvst0, topids_shRNAs_ht1080_PhenDC3vst0), topids_shRNAs_ht1080_SA100128vst0)),
  n234 = length(intersect(intersect(topids_shRNAs_ht1080_DMSOvst0, topids_shRNAs_ht1080_PhenDC3vst0), topids_shRNAs_ht1080_SA100128vst0)),
  n1234 = length(intersect(intersect(intersect(topids_shRNAs_ht1080_PDSvst0, topids_shRNAs_ht1080_DMSOvst0), topids_shRNAs_ht1080_PhenDC3vst0), topids_shRNAs_ht1080_SA100128vst0)),
  category = c(sprintf("PDS (%i)", length(topids_shRNAs_ht1080_PDSvst0)), sprintf("DMSO (%i)", length(topids_shRNAs_ht1080_DMSOvst0)), sprintf("PhenDC3 (%i)", length(topids_shRNAs_ht1080_PhenDC3vst0)), sprintf("SA100128 (%i)", length(topids_shRNAs_ht1080_SA100128vst0))),
  fill = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cex = 1.5,
  fontfamily = "sans",
  cat.cex = 1.5,
  cat.col = c("red3", "deepskyblue3", "forestgreen", "goldenrod3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = "raw",
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_shRNAs_HT1080_venn_FDR5minus2_includingSA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170412_t15vst0_shRNAs_HT1080_venn_FDR5minus2_includingSA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Tables of genes for PDS only, PhenDC3 only, SA100128 only, PDS+PhenDC3 only, PDS+SA100128 only, PhenDC3+SA100128 only and PDS+PhenDC3+SA100128 only with FDR <= 0.05 & logFC < 0 (sensitiser) or logFC > 0 (resistant) & passing the 50% or at least 3 threshold of significant shRNAS

# resistant
# PDS only
top_ht1080_PDSonly_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0))][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_ht1080_PDSonly_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PDSonly_resistant_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PDSonly_resistant_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PhenDC3 only
top_ht1080_PhenDC3only_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0))][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_ht1080_PhenDC3only_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PhenDC3only_resistant_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PhenDC3only_resistant_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# SA100128 only
top_ht1080_SA100128only_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0))][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_ht1080_SA100128only_resistant # empty

# PDS+PhenDC3 only
top_ht1080_PDSandPhenDC3only_PhenDC3_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_ht1080_PDSandPhenDC3only_PDS_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_ht1080_PDSandPhenDC3only_resistant <- merge(top_ht1080_PDSandPhenDC3only_PhenDC3_resistant, top_ht1080_PDSandPhenDC3only_PDS_resistant, by = c("gene", "n_detected_shRNAs"), suffixes = c(".PhenDC3", ".PDS"))[order(-logFC_significant_resistant_shRNAs_median.PhenDC3)]
write.table(top_ht1080_PDSandPhenDC3only_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PDSandPhenDC3only_resistant_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PDSandPhenDC3only_resistant_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PDS+SA100128 only
top_ht1080_PDSandSA100128only_SA100128_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_ht1080_PDSandSA100128only_SA100128_resistant # empty
top_ht1080_PDSandSA100128only_PDS_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_ht1080_PDSandSA100128only_PDS_resistant # empty

# PhenDC3+SA100128 only
top_ht1080_PhenDC3andSA100128only_SA100128_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_ht1080_PhenDC3andSA100128only_SA100128_resistant # empty
top_ht1080_PhenDC3andSA100128only_PhenDC3_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_ht1080_PhenDC3andSA100128only_PhenDC3_resistant # empty

# PDS+PhenDC3+SA100128 only
top_ht1080_PDSandPhenDC3andSA100128only_SA100128_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0)][gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_ht1080_PDSandPhenDC3andSA100128only_SA100128_resistant # empty
top_ht1080_PDSandPhenDC3andSA100128only_PDS_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0)][gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PhenDC3vst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_ht1080_PDSandPhenDC3andSA100128only_PDS_resistant # empty
top_ht1080_PDSandPhenDC3andSA100128only_PhenDC3_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0)][gene %in% c(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_PDSvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_ht1080_PDSandPhenDC3andSA100128only_PhenDC3_resistant # empty

# DMSO
top_ht1080_DMSO_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_ht1080_DMSO_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_DMSO_resistant_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_DMSO_resistant_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")


# sensitiser
# PDS only
top_ht1080_PDSonly_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0))][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_ht1080_PDSonly_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PDSonly_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PDSonly_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PhenDC3 only
top_ht1080_PhenDC3only_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0))][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_a375_PhenDC3only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PhenDC3only_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_A375_PhenDC3only_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# SA100128 only
top_ht1080_SA100128only_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][!(gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0))][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_ht1080_SA100128only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_SA100128only_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_SA100128only_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PDS+PhenDC3 only
top_ht1080_PDSandPhenDC3only_PhenDC3_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_ht1080_PDSandPhenDC3only_PDS_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_ht1080_PDSandPhenDC3only_sensitiser <- merge(top_ht1080_PDSandPhenDC3only_PhenDC3_sensitiser, top_ht1080_PDSandPhenDC3only_PDS_sensitiser, by = c("gene", "n_detected_shRNAs"), suffixes = c(".PhenDC3", ".PDS"))[order(-logFC_significant_sensitiser_shRNAs_median.PhenDC3)]
write.table(top_ht1080_PDSandPhenDC3only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PDSandPhenDC3only_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PDSandPhenDC3only_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PDS+SA100128 only
top_ht1080_PDSandSA100128only_SA100128_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_ht1080_PDSandSA100128only_SA100128_sensitiser # empty
top_ht1080_PDSandSA100128only_PDS_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_ht1080_PDSandSA100128only_PDS_sensitiser # empty

# PhenDC3+SA100128 only
top_ht1080_PhenDC3andSA100128only_SA100128_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_ht1080_PhenDC3andSA100128only_PhenDC3_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_ht1080_PhenDC3andSA100128only_sensitiser <- merge(top_ht1080_PhenDC3andSA100128only_SA100128_sensitiser, top_ht1080_PhenDC3andSA100128only_PhenDC3_sensitiser, by = c("gene", "n_detected_shRNAs"), suffixes = c(".SA100128", ".PhenDC3"))[order(-logFC_significant_sensitiser_shRNAs_median.SA100128)]
write.table(top_ht1080_PhenDC3andSA100128only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PhenDC3andSA100128only_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PhenDC3andSA100128only_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# PDS+PhenDC3+SA100128 only
top_ht1080_PDSandPhenDC3andSA100128only_SA100128_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0)][gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_ht1080_PDSandPhenDC3andSA100128only_PDS_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_PDSvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)][gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PhenDC3vst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_ht1080_PDSandPhenDC3andSA100128only_PhenDC3_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_PhenDC3vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)][gene %in% c(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_PDSvst0)][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
top_ht1080_PDSandPhenDC3andSA100128only_tmp_sensitiser <- merge(top_ht1080_PDSandPhenDC3andSA100128only_SA100128_sensitiser, top_ht1080_PDSandPhenDC3andSA100128only_PDS_sensitiser, by = c("gene", "n_detected_shRNAs"), suffixes = c(".SA100128", ".PDS"))
top_ht1080_PDSandPhenDC3andSA100128only_sensitiser <- merge(top_ht1080_PDSandPhenDC3andSA100128only_PhenDC3_sensitiser, top_ht1080_PDSandPhenDC3andSA100128only_tmp_sensitiser, by = c("gene", "n_detected_shRNAs"))[order(-logFC_significant_sensitiser_shRNAs_median)]
write.table(top_ht1080_PDSandPhenDC3andSA100128only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PDSandPhenDC3andSA100128only_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_PDSandPhenDC3andSA100128only_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# DMSO
top_ht1080_DMSO_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_ht1080_DMSO_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_DMSO_sensitiser_genes_includingSA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170412_HT1080_DMSO_sensitiser_genes_includingSA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")



#############################
# DMSOvst0 and SA100128vst0 #
#############################

# Venn diagram resistant

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0 and SA100128vst0
# DMSOvst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))
# SA100128vst0
topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"]$gene))

venn.plot <- draw.pairwise.venn(
  area1 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0),
  area2 = length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0),
  cross.area = length(intersect(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0)),
  category = c(sprintf("SA100128 (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_SA100128vst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0))),
  scaled = FALSE,
  fill = c("goldenrod3", "deepskyblue3"),
  cex = 2,
  fontfamily = "sans",
  cat.pos = c(-20, 20),
  cat.dist = c(0.06, 0.06),
  cat.cex = 2,
  cat.col = c("goldenrod3", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_resistant_shRNAs_onlySA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_resistant_shRNAs_onlySA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0 and SA100128vst0
# DMSOvst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))
# SA100128vst0
topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"]$gene))

venn.plot <- draw.pairwise.venn(
  area1 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0),
  area2 = length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0),
  cross.area = length(intersect(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  category = c(sprintf("SA100128 (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0))),
  scaled = FALSE,
#  inverted = TRUE,
  fill = c("goldenrod3", "deepskyblue3"),
  cex = 2,
  fontfamily = "sans",
  cat.pos = c(20, -20),
  cat.dist = c(0.06, 0.06),
  cat.cex = 2,
  cat.col = c("goldenrod3", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_onlySA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_onlySA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser (same as above and logFC < -1)

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant genes for DMSOvst0 and SA100128vst0
# DMSOvst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))
# SA100128vst0
topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0 <- unique(as.character(all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[(pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes") & logFC_significant_sensitiser_shRNAs_median <= -1]$gene))

venn.plot <- draw.pairwise.venn(
  area1 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0),
  area2 = length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0),
  cross.area = length(intersect(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0, topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)),
  category = c(sprintf("SA100128 (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_SA100128vst0)), sprintf("DMSO (%i)", length(topids_genes_pass_50_3_minus1_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0))),
  scaled = FALSE,
  fill = c("goldenrod3", "deepskyblue3"),
  cex = 2,
  fontfamily = "sans",
  cat.pos = c(20, -20),
  cat.dist = c(0.06, 0.06),
  cat.cex = 2,
  cat.col = c("goldenrod3", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_logFCminus1_onlySA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_genes_HT1080_venn_FDR5minus2_pass_50pct_or_3_threshold_significant_sensitiser_shRNAs_logFCminus1_onlySA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Venn diagram sensitiser (shRNAs)

# Apply 50% or at least 3 shRNAS cutoff and set vectors containing significant shRNAs for DMSOvst0 and SA100128vst0
# DMSOvst0
topids_shRNAs_ht1080_DMSOvst0 <- top_ht1080_DMSOvst0[FDR <= 0.05 & logFC < 0]$shRNA
# SA100128vst0
topids_shRNAs_ht1080_SA100128vst0 <- top_ht1080_SA100128vst0[FDR <= 0.05 & logFC < 0]$shRNA

venn.plot <- draw.pairwise.venn(
  area1 = length(topids_shRNAs_ht1080_SA100128vst0),
  area2 = length(topids_shRNAs_ht1080_DMSOvst0),
  cross.area = length(intersect(topids_shRNAs_ht1080_DMSOvst0, topids_shRNAs_ht1080_SA100128vst0)),
  category = c(sprintf("SA100128 (%i)", length(topids_shRNAs_ht1080_SA100128vst0)), sprintf("DMSO (%i)", length(topids_shRNAs_ht1080_DMSOvst0))),
  scaled = FALSE,
  fill = c("goldenrod3", "deepskyblue3"),
  cex = 2,
  fontfamily = "sans",
  cat.pos = c(20, -20),
  cat.dist = c(0.06, 0.06),
  cat.cex = 2,
  cat.col = c("goldenrod3", "deepskyblue3"),
  cat.fontface = "bold",
  cat.fontfamily = "sans",
  print.mode = c("raw", "percent"),
  sigdigs = 2,
  margin = 0.075)

pdf("/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_shRNAs_HT1080_venn_FDR5minus2_onlySA100128.pdf", width = 20/2.54, height = 20/2.54)
g <- grid.draw(venn.plot)
dev.off()

system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/figures/20170413_t15vst0_shRNAs_HT1080_venn_FDR5minus2_onlySA100128.pdf martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/figures/venn_diagrams/pass_50pct_or_3_threshold")



# Tables of genes for SA100128 only with FDR <= 0.05 & logFC < 0 (sensitiser) or logFC > 0 (resistant) & passing the 50% or at least 3 threshold of significant shRNAS

# resistant
# SA100128 only
top_ht1080_SA100128only_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][!(gene %in% topids_genes_pass_50_3_threshold_significant_resistant_shRNAs_ht1080_DMSOvst0)][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
top_ht1080_SA100128only_resistant # empty

# DMSO
top_ht1080_DMSO_resistant <- all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_resistant_shRNAs == "yes" | pass_3_significant_resistant_shRNAs == "yes"][order(-logFC_significant_resistant_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_resistant_shRNAs, pct_significant_resistant_shRNAs, logFC_significant_resistant_shRNAs_average, FC_significant_resistant_shRNAs_average, logFC_significant_resistant_shRNAs_median, FC_significant_resistant_shRNAs_median)]
write.table(top_ht1080_DMSO_resistant, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_HT1080_DMSO_resistant_genes_onlySA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_HT1080_DMSO_resistant_genes_onlySA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")


# sensitiser
# SA100128 only
top_ht1080_SA100128only_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_SA100128vst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][!(gene %in% topids_genes_pass_50_3_threshold_significant_sensitiser_shRNAs_ht1080_DMSOvst0)][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_ht1080_SA100128only_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_HT1080_SA100128only_sensitiser_genes_onlySA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_HT1080_SA100128only_sensitiser_genes_onlySA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")

# DMSO
top_ht1080_DMSO_sensitiser <- all_detected_significant_resistant_sensitiser_genes_ht1080_DMSOvst0[pass_50_threshold_significant_sensitiser_shRNAs == "yes" | pass_3_significant_sensitiser_shRNAs == "yes"][order(-logFC_significant_sensitiser_shRNAs_median),.(gene, n_detected_shRNAs, n_significant_sensitiser_shRNAs, pct_significant_sensitiser_shRNAs, logFC_significant_sensitiser_shRNAs_average, FC_significant_sensitiser_shRNAs_average, logFC_significant_sensitiser_shRNAs_median, FC_significant_sensitiser_shRNAs_median)]
write.table(top_ht1080_DMSO_sensitiser, file = "/lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_HT1080_DMSO_sensitiser_genes_onlySA100128.txt", quote = FALSE, sep = "\t", row.names=FALSE)
system("rsync --remove-source-files /lustre/sblab/martin03/repository/20160418_shRNAscreen_katie_darcie/tables/20170413_HT1080_DMSO_sensitiser_genes_onlySA100128.txt martin03@nm149s012925:/media/itshare/research/sblab/group/public_folders/martin03/20160418_shRNAscreen_katie_darcie/20170410/tables/genes_pass_50pct_or_3_threshold")


```
